(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{110:function(e,t){},165:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(12),l=n.n(r),i=(n(80),n(4)),c=n(73),s=n(5),m=n(68),d=n.n(m),u=n(169),f=n(45),h=n(42),g=n(21),p=n(168),v={tl:{r:0,c:0},tr:{r:0,c:22},bl:{r:18,c:0},br:{r:18,c:22}},y={boardDims:{w:23,h:19},boardCorners:v,initialPlayerPos:[v.tl,v.tr],goals:[v.br,v.bl],playerColors:["red","indigo"],groundSize:37,wallWidth:12,smallScreenGroundSize:23,smallScreenWallWidth:10},w=n(2),b=n(15),E=n.n(b),C=n(30),k=n(69),S=n.n(k),x=n(70),T=n.n(x),O=function(e,t){t&&0!==t||(t=2500),Object(g.c)(e,{autoClose:t,hideProgressBar:!0,transition:g.a,pauseOnFocusLoss:!1})};function j(e){return e.r%2===0&&e.c%2===0?"Ground":e.r%2===0&&e.c%2===1||e.r%2===1&&e.c%2===0?"Wall":"Pillar"}function N(e,t){return e.r===t.r&&e.c===t.c}function D(e){for(var t=[],n=0;n<e.h;n++){t[n]=[];for(var a=0;a<e.w;a++)t[n][a]=0}return t}function R(e,t){return e.r>=0&&e.r<t.h&&e.c>=0&&e.c<t.w}function W(e,t){return"Wall"===j(t)&&0!==e[t.r][t.c]}function G(e,t){var n=function(e){return{h:e.length,w:e[0].length}}(e);if("Ground"!==j(t))return[];for(var a=[{r:0,c:1},{r:0,c:-1},{r:1,c:0},{r:-1,c:0}],o=[],r=[t.r,t.c],l=r[0],i=r[1],c=0;c<a.length;c++){var s=[a[c].r,a[c].c],m=s[0],d=s[1],u={r:l+m,c:i+d},f={r:l+2*m,c:i+2*d};R(f,n)&&!W(e,u)&&o.push(f)}return o}function A(e,t,n){if(N(t,n))return 0;var a=e[0].length,o=function(e){return e.r*a+e.c},r=[],l=0;r.push(t);var i=new Map;for(i.set(o(t),0);l<r.length;){var c=r[l];l+=1;for(var s=G(e,c),m=0;m<s.length;m++){var d=s[m];if(!i.has(o(d))){if(i.set(o(d),i.get(o(c))+1),N(d,n))return i.get(o(d));r.push(d)}}}return-1}function L(e,t,n,a){if(N(t,n))return 0;var o=e[0].length,r=function(e){return e.r*o+e.c},l=[],i=0;l.push(t);var c=new Map;for(c.set(r(t),0);i<l.length;){var s=l[i];i+=1;var m=c.get(r(s));if(m>a)return!1;for(var d=G(e,s),u=0;u<d.length;u++){var f=d[u];if(!c.has(r(f))){if(N(f,n))return m+1<=a;c.set(r(f),m+1),l.push(f)}}}return!1}function M(e,t,n){return-1!==A(e,t,n)}function I(e,t,n,a){if(W(e,a))return!1;e[a.r][a.c]=1;var o=function(e,t,n){for(var a=0;a<t.length;a++)if(!M(e,t[a],n[a]))return!1;return!0}(e,t,n);return e[a.r][a.c]=0,o}var B=n(71),H=n.n(B),z="#d2d2d2",P="#fbe4D6",_="#eaeaea",V="#f1bfa0",q="#cccccc",J=["face","outlet"],F="1px solid #00796d",U=function(e){for(var t=e.grid,n=e.ghostAction,r=e.premoveActions,l=Object(i.a)(e.playerColors,2),c=l[0],s=l[1],m=Object(i.a)(e.playerPos,2),d=m[0],u=m[1],f=Object(i.a)(e.goals,2),h=f[0],g=f[1],p=e.handleClick,v=e.creatorToMove,y=e.groundSize,w=e.wallWidth,b=e.isDarkModeOn,E=t.length,C=t[0].length,k=[],S=0;S<E;S++)for(var x=0;x<C;x++)k[S*C+x]={r:S,c:x};var T=Object(i.a)(J,2),O=T[0],D=T[1],R=(E-1)/2,W=(C-1)/2,G=Object(a.useState)(null),A=Object(i.a)(G,2),L=A[0],M=A[1],I=function(){M(null)},B=.8*y,U="white";return b&&(U="black"),o.a.createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(".concat(W,", ").concat(y,"px ").concat(w,"px) ").concat(y,"px"),gridTemplateRows:"repeat(".concat(R,", ").concat(y,"px ").concat(w,"px) ").concat(y,"px"),justifyContent:"center",gridArea:"board",MozUserSelect:"none",webkitUserSelect:"none",msUserSelect:"none",userSelect:"none"}},k.map((function(e){var a,l=[N(e,d),N(e,u)],i=l[0],m=l[1],f=[N(e,h),N(e,g)],w=f[0],k=f[1],S=null!==n&&N(n,e),x=r.length>0&&N(r[0],e)||r.length>1&&N(r[1],e),T=S&&v||x&&!v,R=S&&!v||x&&v,W=j(e);a="Ground"===W?L&&N(e,L)?P:z:"Wall"===W?L&&N(e,L)?V:_:q,b&&(a=H()(a));var G="";"Ground"===W&&(G+=" waves-effect waves-light"),"Wall"===W&&(G+=" waves-effect waves-dark");var A=i||m||T||R,J=y>27&&!(A||w||k),Y=J&&e.r===E-1&&e.c%2===0,Q=J&&e.c===C-1&&e.r%2===0,K=Y||Q;if((w||k)&&(G=w?c:s,G+=b?" darken-4":" lighten-4"),"Wall"===W){var X=0!==t[e.r][e.c];(X||S||x)&&(X?(G=1===t[e.r][e.c]?c:s,G+=b?"":" darken-3"):S?(G=v?c:s,G+=b?" lighten-2":" lighten-3"):(G=v?s:c,G+=b?" lighten-2":" lighten-3"))}var Z="center";K&&(Z=Y?"start":"flex-end");var $="center";return K&&($=Y?"flex-end":"flex-start"),o.a.createElement("div",{className:G,key:"cell_".concat(e.r,"_").concat(e.c),onClick:function(){"Pillar"!==W&&null!==p&&p(e)},onMouseEnter:function(){return function(e){M(e)}(e)},onMouseLeave:I,style:{backgroundColor:a,display:"flex",justifyContent:Z,alignItems:$,cursor:"pointer",borderTop:0===e.r?F:"",borderBottom:e.r===E-1?F:"",borderLeft:0===e.c?F:"",borderRight:e.c===C-1?F:""}},i&&o.a.createElement("i",{className:"material-icons ".concat(c,"-text"),style:{fontSize:"".concat(B,"px")}},O),m&&o.a.createElement("i",{className:"material-icons ".concat(s,"-text"),style:{fontSize:"".concat(B,"px")}},D),w&&!A&&o.a.createElement("i",{className:"material-icons white-text",style:{fontSize:"".concat(B,"px")}},O),k&&!A&&o.a.createElement("i",{className:"material-icons white-text",style:{fontSize:"".concat(B,"px")}},D),T&&"Ground"===W&&o.a.createElement("i",{className:"material-icons ".concat(c,"-text text-lighten-4"),style:{fontSize:"".concat(B,"px")}},O),R&&"Ground"===W&&o.a.createElement("i",{className:"material-icons ".concat(s,"-text text-lighten-4"),style:{fontSize:"".concat(B,"px")}},D),Y&&o.a.createElement("div",{style:{color:U,padding:"0",marginLeft:"4px"}},String.fromCharCode(97+e.c/2)),Q&&o.a.createElement("div",{style:{color:U,padding:"0",marginRight:"4px"}},""+(1+e.r/2)))})))},Y=(n(158),n(72)),Q=(n(162),function(e){var t,n=e.icon,a=e.tooltip,r=e.onClick,l=e.modalTitle,i=e.modalBody,c=e.modalConfirmButtonText,s=e.bgColor,m=e.padding,d=e.disabled;if(!i)return o.a.createElement(w.Button,{className:s||"teal",node:"button",waves:"light",icon:o.a.createElement(w.Icon,{className:"large"},n),onClick:r,tooltip:a,disabled:d});t=c&&""!==c?[o.a.createElement(w.Button,{style:{backgroundColor:"#009688",color:"white",marginRight:"1rem"},flat:!0,modal:"close",node:"button",waves:"green",onClick:r},c),o.a.createElement(w.Button,{style:{backgroundColor:"#009688",color:"white"},flat:!0,modal:"close",node:"button",waves:"green"},"Cancel")]:o.a.createElement(w.Button,{style:{backgroundColor:"#009688",color:"white"},flat:!0,modal:"close",node:"button",waves:"green"},"Close");var u=o.a.createElement(w.Button,{style:{padding:"0px ".concat(m,"px")},className:s||"teal",node:"button",waves:"light",icon:o.a.createElement(w.Icon,{className:"large"},n),tooltip:a,disabled:d});return o.a.createElement(w.Modal,{style:{color:"black",backgroundColor:"white"},bottomSheet:!1,fixedFooter:!1,header:l,open:!1,options:{dismissible:!0,endingTop:"10%",inDuration:250,opacity:.4,outDuration:250,preventScrolling:!0,startingTop:"4%"},trigger:u,actions:t},o.a.createElement("div",null,i))});var K=function(e){var t,n=e.gameName,a=e.helpText,r=e.isLargeScreen,l=e.isDarkModeOn,i=e.handleToggleDarkMode;t=n?o.a.createElement("span",null,r&&o.a.createElement("span",null,"WallWars\xa0\xa0"),o.a.createElement(Y.CopyToClipboard,{style:{cursor:"pointer"},text:n,onCopy:function(){return O("Join code copied to clipboard!")}},o.a.createElement("span",null,"Game ",n))):o.a.createElement("span",null,"WallWars");var c=o.a.createElement("div",null,o.a.createElement("h6",null,"Wallwars is an online 2-player strategy game. The goal is to get to your goal before the opponent gets to hers, building walls to reshape the terrain to your advantage."),o.a.createElement("h6",null,"It is implemented by Nil M and inspired by a board game he played once as a kid, of which he doesn't remember the name, unfortunately."),o.a.createElement("h6",null,"The frontend is made with React, and the backend with Node.js, Express, and socket.io."),o.a.createElement("h6",null,"The source code is available at https://github.com/nmamano/WallWars")),s=l?"red darken-4":"red lighten-1",m=r?20:11;return o.a.createElement("div",null,o.a.createElement("div",{className:s,style:{height:"50px",display:"grid",gridTemplateRows:"1fr",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center"}},o.a.createElement("div",{style:{fontSize:r?"30px":"25px",marginLeft:r?"15px":"5px"}},t),o.a.createElement("div",{style:{height:"auto",display:"grid",padding:"5px",gridTemplateColumns:"repeat(3, 1fr)",gridTemplateRows:"auto",columnGap:"5px",rowGap:"5px",marginRight:r?"15px":"5px"}},o.a.createElement(Q,{icon:l?"brightness_2":"brightness_4",tooltip:l?"Turn off dark mode":"Turn on dark mode",onClick:i,bgColor:"red darken-1",padding:m}),o.a.createElement(Q,{icon:"help",tooltip:"Help",modalTitle:"Help",modalBody:a,bgColor:"red darken-1",padding:m}),o.a.createElement(Q,{icon:"info",tooltip:"About",modalTitle:"About",modalBody:c,bgColor:"red darken-1",padding:m}))))},X=function(e){var t=e.title,n=e.body,a=e.acceptButtonText,r=e.rejectButtonText,l=e.isOpen,i=e.callback;return o.a.createElement(w.Modal,{style:{color:"black",backgroundColor:"white"},header:t,open:l,options:{dismissible:!1,endingTop:"10%",inDuration:250,opacity:.4,outDuration:250,preventScrolling:!0,startingTop:"4%"},actions:[o.a.createElement(w.Button,{style:{backgroundColor:"#009688",color:"white",marginRight:"1rem"},flat:!0,modal:"close",node:"button",waves:"green",onClick:function(){i(!0)}},a||"Accept"),o.a.createElement(w.Button,{style:{backgroundColor:"#009688",color:"white"},flat:!0,modal:"close",node:"button",waves:"green",onClick:function(){i(!1)}},r||"Cancel")]},o.a.createElement("div",null,n))},Z=function(e){var t,n=e.names,a=e.lifeCycleStage,r=e.winner,l=e.finishReason,i=e.indexToMove,c=e.timeControl,s=e.creatorStarts,m=e.isLargeScreen,d=n[i];switch(a){case-2:t="Haven't tried to connect to the server yet";break;case-1:t="Waking the server up...";break;case 0:t="Waiting for player 2 to join";break;case 1:t="".concat(d," starts");break;case 2:case 3:t="".concat(d," to move");break;case 4:t="draw"===r?"The game ended in a draw "+{goal:"by the 1-move rule",agreement:"by agreement"}[l]:"".concat(n["creator"===r?0:1]," won ").concat({time:"on time",goal:"by reaching the goal",resign:"by resignation",disconnect:"by disconnection"}[l]);break;default:console.error("stage should be in range [-2..4]")}var u=function(e){return Math.round(100*(e+Number.EPSILON))/100};return o.a.createElement("div",{className:"teal darken-2",style:{display:"grid",gridTemplateColumns:"auto",gridTemplateRows:"1fr 1fr 1fr",alignItems:"center",padding:m?"15px 15px":"5px 15px",gridArea:"status"}},o.a.createElement("div",null,o.a.createElement("p",null,t)),o.a.createElement("div",null,c&&o.a.createElement("p",null,"Time control: ",u(c.duration),"+",u(c.increment))),o.a.createElement("div",null,o.a.createElement("p",null,"First move:"+(a>1?" ".concat(n[s?0:1]):""))))},$=function(e){var t=e.lifeCycleStage,n=e.names,a=e.playerColors,r=e.timeLeft,l=e.indexToMove,i=e.isLargeScreen,c=e.scores,s=[Math.floor(r[0]/60),Math.floor(r[1]/60)],m=s[0],d=s[1],u=r[0]%60,f=r[1]%60,h=["".concat(m,":").concat(u<10?"0":"").concat(u),"".concat(d,":").concat(f<10?"0":"").concat(f)];t<0&&(h[0]="_:__",h[1]="_:__");var g=["",""];if(t<4){g[l]=a[l]+" lighten-1 z-depth-2"}var p=["",""];3===t&&(0===l?r[0]<15&&(p[0]=" orange lighten-2 z-depth-2"):1===l&&r[1]<15&&(p[1]=" orange lighten-2 z-depth-2"));var v,y=0!==c[0]||0!==c[1],w={padding:v=i&&!y?"15px":i&&y?"12px":i||y?"6px":"8px",fontSize:i?"18px":"14px"};return o.a.createElement("div",{className:"teal darken-2",style:{display:"grid",gridTemplateColumns:y?"0.5fr 1.7fr 1fr 1fr 1.7fr 0.5fr":"1.7fr 1fr 1fr 1.7fr",gridTemplateRows:"auto",alignContent:"center",columnGap:v,padding:v,gridArea:"timer"}},y&&o.a.createElement("div",{style:w,className:"center"},c[0]),o.a.createElement("div",{style:w,className:g[0]+" center truncate"},n[0]),o.a.createElement("div",{style:w,className:p[0]+" center"},h[0]),o.a.createElement("div",{style:w,className:p[1]+" center"},h[1]),o.a.createElement("div",{style:w,className:g[1]+" center truncate"},null===n[1]?"______":n[1]),y&&o.a.createElement("div",{style:w,className:"center"},c[1]))},ee=function(){return o.a.createElement("div",null,o.a.createElement("h6",null,'To connect with your friend, share the game code in the top header with them and tell them to use it when clicking "Join Game" from the lobby. Click on the code to copy it to the clipboard.'),o.a.createElement("h6",null,"Rules of the game:"),o.a.createElement("h6",null,"The player who created the game starts at the top left corner (color red). The player who joined the game starts at the top right (color blue). The goal of each player is to reach the ",o.a.createElement("em",null,"opposite")," corner from where they start. The player who gets there first, wins."),o.a.createElement("h6",null,"Players move by clicking cells on the board. There are two types of cells: ground cells (the big squares) and walls (the thin rectangles in between ground cells). Each move consists of a total of two actions. One action can be building one wall or moving to an adjacent cell (a diagonal move counts as two actions)."),o.a.createElement("h6",null,"Players can build walls to obstruct the opponent. Walls can be built anywhere as long as there always exists at least one way to get to their goal."),o.a.createElement("h6",null,"The remaining time for each player is shown next to their name. The clock of a player ticks down when it is their turn (after each player has moved once). The player who starts is chosen randomly. The name of the player to move next is highlighted with their color."),o.a.createElement("h6",null,"If it is your turn and you do a single action, like building a wall or moving to an adjacent cell, you can undo it by clicking the wall again or clicking a different ground cell, respectively. Once you choose 2 actions, the move becomes permanent."),o.a.createElement("h6",null,"Special rules:"),o.a.createElement("h6",null,"(1) no walls can be placed during the first move of each player."),o.a.createElement("h6",null,"(2) if the player who moved first reaches the goal first but the other player is at distance 1 or 2 from her goal, the game ends in a draw."),o.a.createElement("h6",null,"Note: if you return to the lobby, you will not be able to reenter this game!"))},te={position:"sticky",top:"0px",paddingTop:"0.15rem",paddingBottom:"0.15rem",borderRadius:"0"},ne={paddingTop:"0.15rem",paddingBottom:"0.15rem",borderRadius:"0"},ae=function(e){var t=e.moveHistory,n=e.playerColors,a=e.creatorStarts,r=e.handleViewMove,l=e.viewIndex,i=e.height;return o.a.createElement("div",{id:"movehistory",className:"center",style:{overflowY:"scroll",display:"block",height:i,MozUserSelect:"none",webkitUserSelect:"none",msUserSelect:"none",userSelect:"none"}},o.a.createElement(w.Table,{centered:!0,style:{width:"100%"}},o.a.createElement("thead",null,o.a.createElement("tr",null,o.a.createElement("th",{className:"teal darken-2",style:te},"Move"),o.a.createElement("th",{className:"teal darken-2",style:te},"Actions"),o.a.createElement("th",{className:"teal darken-2",style:te},"Distance"),o.a.createElement("th",{className:"teal darken-2",style:te},"# Walls"))),o.a.createElement("tbody",null,t.map((function(e,i){var c;return 0===i?c=void 0:(c=a?n[(i+1)%2]:n[i%2],c+=" lighten-2"),l===i&&i<t.length-1&&(c="amber darken-1"),o.a.createElement("tr",{onClick:function(){return r(i)},style:{cursor:"pointer"},key:i,className:c},o.a.createElement("td",{style:ne},i),o.a.createElement("td",{style:ne},function(e){if(0===e.index)return"__";for(var t=0,n=0;n<e.actions.length;n++){"Wall"===j(e.actions[n])&&(t+=1)}return 0===t?"GG":1===t?"GW":"WW"}(e)),o.a.createElement("td",{style:ne},e.distances[0]+" - "+e.distances[1]),o.a.createElement("td",{style:ne},e.wallCounts[0]+" - "+e.wallCounts[1]))})))))},oe=function(e){var t=e.lifeCycleStage,n=e.handleResign,a=e.handleOfferDraw,r=e.handleRequestTakeback,l=e.handleGiveExtraTime,i=e.moveHistory,c=e.playerColors,s=e.clientRole,m=e.creatorStarts,d=e.handleViewMove,u=e.viewIndex,f=e.turnCount,h=e.handleSeeFirstMove,g=e.handleSeePreviousMove,p=e.handleSeeNextMove,v=e.handleSeeLastMove,y=e.handleToggleVolume,w=e.isVolumeOn,b=e.handleLeaveGame,E=e.handleIncreaseBoardSize,C=e.handleDecreaseBoardSize,k=e.zoomLevel,S=e.boardHeight-108-15-10,x=3===t||2===t&&m===("Creator"===s),T="Spectator"===s;return o.a.createElement("div",{className:"teal darken-2",style:{width:"100%",height:"auto",display:"grid",padding:"".concat(5,"px"),gridTemplateColumns:"repeat(4, 1fr)",gridTemplateRows:"".concat(36,"px 1fr ").concat(36,"px ").concat(36,"px"),columnGap:"".concat(5,"px"),rowGap:"".concat(5,"px"),gridArea:"panel"}},o.a.createElement(Q,{icon:"flag",tooltip:"Resign",modalTitle:"Resign",modalBody:"Are you sure you want to resign?",modalConfirmButtonText:"Resign",onClick:n,disabled:T||3!==t}),o.a.createElement(Q,{icon:"local_florist",tooltip:"Offer Draw",modalTitle:"Offer Draw",modalBody:"Are you sure you want to offer a draw?",modalConfirmButtonText:"Offer draw",onClick:a,disabled:T||3!==t}),o.a.createElement(Q,{icon:"replay",tooltip:"Request takeback",onClick:function(){O("A takeback request was sent to the opponent.",5e3),r()},disabled:T||!x}),o.a.createElement(Q,{icon:"add_alarm",tooltip:"Give 60 seconds",onClick:function(){O("You added 60s to the opponent's clock.",5e3),l()},disabled:T||3!==t}),o.a.createElement("div",{style:{gridColumnStart:"1",gridColumnEnd:"5"}},o.a.createElement(ae,{moveHistory:i,playerColors:c,creatorStarts:m,handleViewMove:d,viewIndex:u,height:S})),o.a.createElement(Q,{icon:"fast_rewind",onClick:h,disabled:t<=1||0===u}),o.a.createElement(Q,{icon:"navigate_before",onClick:g,disabled:t<=1||0===u}),o.a.createElement(Q,{icon:"navigate_next",onClick:p,disabled:t<=1||u===f}),o.a.createElement(Q,{icon:"fast_forward",onClick:v,disabled:t<=1||u===f}),o.a.createElement(Q,{icon:w?"volume_up":"volume_off",tooltip:w?"Turn off sound effects":"Turn on sound effects",onClick:y,disabled:T}),o.a.createElement(Q,{icon:"zoom_out",tooltip:"Decrease board size",onClick:C,disabled:0===k}),o.a.createElement(Q,{icon:"zoom_in",tooltip:"Increase board size",onClick:E,disabled:10===k}),o.a.createElement(Q,{icon:"home",tooltip:"Quit game",onClick:b,modalTitle:"Return to lobby",modalBody:"Are you sure you want to return to the lobby?",modalConfirmButtonText:"Quit game"}))},re=new S.a(T.a),le=function(){re.play()},ie=y.goals,ce=y.boardDims,se=y.initialPlayerPos,me=function(e){return e.moveHistory.length-1},de=function(e){return me(e)%2===(e.creatorStarts?0:1)},ue=function(e){return de(e)?0:1},fe=function(e){return null===e?"None":j(e)},he=function(e,t,n,a,o,r,l){for(var i=E()(e),c=0;c<l.length;c++){var s=l[c];i[s.r][s.c]=1}return"Ground"===j(t)?A(i,n,t):I(i,[n,a],[o,r],t)?1:0},ge=function(e,t){if(t&&(t.isVolumeOn&&"true"===t.isVolumeOn&&(e.isVolumeOn=!0),t.zoomLevel)){var n=parseInt(t.zoomLevel);n>=0&&n<=10&&(e.zoomLevel=n)}},pe=function(e,t,n){e.lifeCycleStage=-1,e.timeControl=t,e.names[0]=n;var a=60*t.duration;e.moveHistory[0].timeLeft=[a,a]},ve=function(e,t,n){0!==e.lifeCycleStage&&(e.joinCode=t,e.creatorStarts=n,e.lifeCycleStage=0)},ye=function(e,t){1!==e.lifeCycleStage&&(e.names[1]=t,e.lifeCycleStage=1)},we=function(e,t,n,a){if(!(e.lifeCycleStage<1||e.lifeCycleStage>3)){var o=me(e);if(o===a-1){var r=ue(e),l=0===r?1:0,i=E()(e.moveHistory[o].playerPos),c=E()(e.moveHistory[o].grid),s=E()(e.moveHistory[o].timeLeft),m=E()(e.moveHistory[o].wallCounts);s[r]=n;for(var d=0;d<t.length;d++){var u=t[d],f=j(u);if("Ground"===f){if(i[r]=u,N(u,ie[r])){var h=o%2===0,g=L(c,i[l],ie[l],2);h&&g?(e.winner="draw",e.gameWins[0]+=.5,e.gameWins[1]+=.5):(e.winner=0===r?"creator":"joiner",e.gameWins[r]+=1),e.finishReason="goal",e.lifeCycleStage=4}}else"Wall"===f?(c[u.r][u.c]=r+1,m[r]+=1):console.error("unexpected action type",f)}if(e.moveHistory.push({index:o+1,actions:t,grid:c,playerPos:i,timeLeft:s,distances:[A(c,i[0],ie[0]),A(c,i[1],ie[1])],wallCounts:m}),1===e.lifeCycleStage&&0===o?e.lifeCycleStage=2:2===e.lifeCycleStage&&1===o&&(e.lifeCycleStage=3),e.ghostAction=null,e.viewIndex=o+1,e.premoveActions.length>0){var p=e.premoveActions;e.premoveActions=[];for(var v=0;v<p.length;v++)be(e,p[v],!0,!1)}}}},be=function(e,t,n,a){if(n){if(!(e.lifeCycleStage<1)&&!(e.lifeCycleStage>3)&&e.viewIndex===me(e)&&!(t.r<0||t.r>=ce.h||t.c<0||t.c>=ce.w)){var o=j(t);if(!(e.lifeCycleStage<3&&"Wall"===o)){var r=ue(e),l=0===r?1:0,i=fe(e.ghostAction),c="Wall"===i?[e.ghostAction]:[],s=me(e),m=e.moveHistory[s].playerPos[r];"Wall"===o&&"Ground"===i&&(m=e.ghostAction);var d=he(e.moveHistory[s].grid,t,m,e.moveHistory[s].playerPos[l],ie[r],ie[l],c);if(!(d>2)){var u=null,f=null;if("None"===i){if("Wall"===o){if(1!==d)return;f=t}else if("Ground"===o)if(1===d)f=t;else{if(2!==d)return;u=[t]}}else if("Wall"===i){if("Wall"===o)if(N(e.ghostAction,t))f=null;else{if(1!==d)return;u=[t,e.ghostAction]}else if("Ground"===o)if(0===d)f=null;else{if(1!==d)return;u=[t,e.ghostAction]}}else if("Ground"===i){if("Wall"===o){if(1!==d)return;u=[t,e.ghostAction]}else if("Ground"===o)if(0===d)f=null;else if(1===d)f=N(t,e.ghostAction)?null:t;else{if(2!==d)return;u=[t]}}else console.error("unexpected ghost type",i);if(u){var h=ue(e),g=me(e),p=e.moveHistory[g].timeLeft[h];3===e.lifeCycleStage&&(p+=e.timeControl.increment),e.moveToSend={actions:u,remainingTime:p},a&&e.isVolumeOn&&le(),we(e,u,p,me(e)+1)}else e.ghostAction=f}}}}else Ee(e,t)},Ee=function(e,t){if(!(e.lifeCycleStage>3)&&e.viewIndex===me(e)&&!(t.r<0||t.r>=ce.h||t.c<0||t.c>=ce.w)){var n=j(t);if(!(e.lifeCycleStage<2&&"Wall"===n)){for(var a=0===ue(e)?1:0,o=0===a?1:0,r=me(e),l=[],i=null,c=0;c<e.premoveActions.length;c++){var s=e.premoveActions[c];"Wall"===j(s)?l.push(s):i=s}var m=e.moveHistory[r].playerPos[a];"Wall"===n&&i&&(m=i);var d=he(e.moveHistory[r].grid,t,m,e.moveHistory[r].playerPos[o],ie[a],ie[o],l),u=null;if(i&&(u=he(e.moveHistory[r].grid,i,e.moveHistory[r].playerPos[a],e.moveHistory[r].playerPos[o],ie[a],ie[o],l)),!(d>2)){var f;if(0===e.premoveActions.length)f="Empty";else if(i||1!==l.length)if(i||2!==l.length)if(i&&1===l.length)f="GroundWall";else if(i&&1===u)f="GroundDist1";else{if(!i||2!==u)return void console.error("Unknown premove state",i,l,d,u);f="GroundDist2"}else f="WallWall";else f="Wall";var h=null;if(N(t,m))return 0===e.premoveActions.length?void 0:void(e.premoveActions=[]);var g=null,p=null;if(1===l.length){var v=[l[0],null];g=v[0],p=v[1]}else if(2===l.length){var y=[l[0],l[1]];g=y[0],p=y[1]}if("Empty"===f)if("Wall"===n){if(1!==d)return;h=[t]}else"Ground"===n&&(1===d||2===d?h=[t]:console.error("unreachable case"));else if("Wall"===f){if("Wall"===n)if(N(g,t))h=[];else{if(1!==d)return;h=[g,t]}else if("Ground"===n){if(1!==d)return;h=[g,t]}}else if("WallWall"===f){if("Wall"===n)if(N(g,t))h=[p];else{if(!N(p,t))return;h=[g]}else if("Ground"===n)return}else if("GroundDist1"===f)if("Wall"===n){if(1!==d)return;h=[i,t]}else"Ground"===n&&(h=N(t,i)?[]:[t]);else if("GroundDist2"===f){if("Wall"===n)return;"Ground"===n&&(h=N(t,i)?[]:[t])}else if("GroundWall"===f){if("Wall"===n){if(!N(t,g))return;h=[i]}else if("Ground"===n)if(N(t,i))h=[g];else{if(1!==d)return;h=[g,t]}}else console.error("unexpected premove state case",f);h&&(e.premoveActions=h)}}}},Ce=function(e){e.showRematchDialog=!1,e.showDrawDialog=!1,e.showTakebackDialog=!1},ke=function(e,t){3===e.lifeCycleStage&&(e.isVolumeOn&&le(),e.lifeCycleStage=4,e.winner="draw",e.gameWins[0]+=.5,e.gameWins[1]+=.5,e.finishReason=t,e.ghostAction=null,Ce(e))},Se=function(e,t){3===e.lifeCycleStage&&(e.lifeCycleStage=4,e.winner=t?"joiner":"creator",e.gameWins[t?1:0]+=1,e.finishReason="resign",e.ghostAction=null,Ce(e))},xe=function(e,t){if(e.showTakebackDialog=!1,2===e.lifeCycleStage||3===e.lifeCycleStage){for(var n=t===de(e)?2:1,a=0;a<n;a++)e.moveHistory.pop();e.ghostAction=null;var o=me(e);e.viewIndex=o,0===o?e.lifeCycleStage=1:1===o&&(e.lifeCycleStage=2)}},Te=function(e){if(4===e.lifeCycleStage){e.creatorStarts=!e.creatorStarts;var t=D(ce);e.moveHistory=[{index:0,actions:[],grid:t,playerPos:se,timeLeft:[60*e.timeControl.duration,60*e.timeControl.duration],distances:[A(t,se[0],ie[0]),A(t,se[1],ie[1])],wallCounts:[0,0]}],e.winner="",e.finishReason="",e.lifeCycleStage=1,e.viewIndex=0,e.ghostAction=null,Ce(e)}},Oe=function(e,t){if(3===e.lifeCycleStage){var n=me(e);e.moveHistory[n].timeLeft[t]+=60}},je=function(e){var t=e.socket,n=e.clientParams,r=e.returnToLobby,l=e.isLargeScreen,c=e.isDarkModeOn,s=e.handleToggleDarkMode,m=n.clientRole,d=Object(p.a)(["isVolumeOn","zoomLevel"]),u=Object(i.a)(d,2),f=u[0],h=u[1],g=Object(C.a)(function(e){var t={joinCode:null,timeControl:null,names:[null,null],gameWins:[0,0],opponentLeft:!1,creatorStarts:null,winner:"",finishReason:"",lifeCycleStage:-2,moveHistory:[{index:0,actions:[],grid:D(ce),playerPos:se,timeLeft:[null,null],distances:[A(D(ce),se[0],ie[0]),A(D(ce),se[1],ie[1])],wallCounts:[0,0]}],moveToSend:null,ghostAction:null,premoveActions:[],isVolumeOn:!1,showBackButtonWarning:!1,isKeyPressed:!1,viewIndex:0,zoomLevel:5,showDrawDialog:!1,showTakebackDialog:!1,showRematchDialog:!1};return ge(t,e),t}(f)),v=Object(i.a)(g,2),b=v[0],E=v[1];Object(a.useEffect)((function(){return t.once("gameCreated",(function(e){var t=e.joinCode,n=e.creatorStarts;E((function(e){ve(e,t,n)}))})),t.once("gameJoined",(function(e){var t=e.creatorName,n=e.timeControl,a=e.creatorStarts;E((function(e){!function(e,t,n,a){if(1!==e.lifeCycleStage){e.creatorStarts=a,e.names[0]=t,e.timeControl=n;var o=60*n.duration;e.moveHistory[0].timeLeft=[o,o],e.lifeCycleStage=1}}(e,t,n,a)}))})),t.once("requestedGame",(function(e){var t=e.game;E((function(e){!function(e,t){pe(e,t.timeControl,t.playerNames[0]),ve(e,t.joinCode,t.creatorStarts),ye(e,t.playerNames[1]);for(var n=0;n<t.moveHistory.length;n++){var a=t.moveHistory[n].actions,o=t.moveHistory[n].remainingTime;we(e,a,o,n+1)}e.gameWins=t.gameWins,e.winner=t.winner,e.finishReason=t.finishReason,e.lifeCycleStage=4}(e,t)}))})),t.once("gameJoinFailed",(function(){O("There is no game with this code waiting for someone to join.",5e3),r()})),t.on("gameNotFoundError",(function(){O("There was an issue on the server and we couldn't reach the other player.",5e3)})),t.once("joinerJoined",(function(e){var t=e.joinerName;E((function(e){1!==e.lifeCycleStage&&(e.isVolumeOn&&le(),ye(e,t))}))})),t.on("drawOffered",(function(){E((function(e){e.showDrawDialog=!0}))})),t.on("drawRejected",(function(){O("The opponent declined the draw offer.",5e3)})),t.on("drawAccepted",(function(){O("The opponent accepted the draw offer.",5e3),E((function(e){ke(e,"agreement")}))})),t.on("takebackRequested",(function(){E((function(e){e.showTakebackDialog=!0}))})),t.on("takebackRejected",(function(){O("The opponent declined the takeback request.",5e3)})),t.on("takebackAccepted",(function(){O("The opponent agreed to the takeback.",5e3),E((function(e){xe(e,"Creator"===m)}))})),t.on("rematchOffered",(function(){E((function(e){e.showRematchDialog=!0}))})),t.on("rematchRejected",(function(){O("The opponent declined the rematch offer.",5e3)})),t.on("rematchAccepted",(function(){O("The opponent accepted the rematch offer.",5e3),E((function(e){e.isVolumeOn&&le(),Te(e)}))})),t.on("extraTimeReceived",(function(){O("The opponent added 60s to your clock.",5e3),E((function(e){Oe(e,"Creator"===m?0:1)}))})),t.on("resigned",(function(){O("The opponent resigned.",5e3),E((function(e){e.isVolumeOn&&le(),Se(e,"Creator"!==m)}))})),t.on("moved",(function(e){var t=e.actions,n=e.moveIndex,a=e.remainingTime;E((function(e){console.log("move ".concat(n," received (").concat(a,"s)")),e.isVolumeOn&&le(),we(e,t,a,n)}))})),t.on("leftGame",(function(){O("The opponent left the game.",5e3),E((function(e){!function(e,t){e.opponentLeft=!0,4!==e.lifeCycleStage&&(e.lifeCycleStage=4,e.winner=t?"joiner":"creator",e.gameWins[t?1:0]+=1,e.finishReason="disconnect",e.ghostAction=null,Ce(e))}(e,"Creator"!==m)}))})),function(){t.removeAllListeners()}}),[t,E,m,r]),Object(a.useEffect)((function(){-2===b.lifeCycleStage&&("Creator"===m?(E((function(e){pe(e,n.timeControl,n.creatorName)})),t.emit("createGame",{creatorName:n.creatorName,timeControl:n.timeControl})):"Joiner"===m?(E((function(e){!function(e,t,n){e.lifeCycleStage=-1,e.joinCode=t,e.names[1]=n}(e,n.joinCode,n.joinerName)})),t.emit("joinGame",{joinCode:n.joinCode,joinerName:n.joinerName})):"Spectator"===m?t.emit("getGame",{gameId:n.gameId}):console.error("unknown client role",m))}));var k=function(){t.emit("leaveGame"),r()};Object(a.useEffect)((function(){var e=setInterval((function(){E((function(e){!function(e){if(3===e.lifeCycleStage){var t=ue(e),n=me(e);e.moveHistory[n].timeLeft[t]-=1,0===e.moveHistory[n].timeLeft[t]&&(e.winner=0===t?"joiner":"creator",e.gameWins[0===t?1:0]+=1,e.finishReason="time",e.lifeCycleStage=4,e.ghostAction=null,Ce(e))}}(e)}))}),1e3);return function(){return clearInterval(e)}}),[E]);var S=function(e){E((function(t){var n=de(t)===("Creator"===m);be(t,e,n,!0)}))};Object(a.useEffect)((function(){b.moveToSend&&(t.emit("move",b.moveToSend),E((function(e){e.moveToSend=null})))})),Object(a.useEffect)((function(){"Creator"===m&&("time"===b.finishReason&&t.emit("playerWonOnTime",{winner:b.winner}),"goal"===b.finishReason&&t.emit("playerReachedGoal",{winner:b.winner}))}),[m,t,b.winner,b.finishReason]);Object(a.useEffect)((function(){return window.addEventListener("keydown",x),window.addEventListener("keyup",T),function(){window.removeEventListener("keydown",x),window.removeEventListener("keyup",T)}}));var x=function(e){var t=e.key;if(!b.isKeyPressed)if(E((function(e){e.isKeyPressed=!0})),"m"!==t)if(b.viewIndex<me(b)||4===b.lifeCycleStage)"ArrowDown"===t||"ArrowRight"===t?b.viewIndex<me(b)&&E((function(e){e.viewIndex+=1})):"ArrowUp"!==t&&"ArrowLeft"!==t||b.viewIndex>0&&E((function(e){e.viewIndex-=1}));else{var n;if(b.ghostAction&&"Ground"===fe(b.ghostAction))n=b.ghostAction;else{var a=me(b);n=b.moveHistory[a].playerPos[ue(b)]}if("ArrowDown"===t)n={r:n.r+2,c:n.c};else if("ArrowUp"===t)n={r:n.r-2,c:n.c};else if("ArrowLeft"===t)n={r:n.r,c:n.c-2};else{if("ArrowRight"!==t)return;n={r:n.r,c:n.c+2}}S(n)}else W()},T=function(){E((function(e){e.isKeyPressed=!1}))},j=function(e){e<0||e>me(b)||E((function(t){t.viewIndex!==e&&(e>me(t)||(t.viewIndex=e,t.ghostAction=null))}))};Object(a.useEffect)((function(){var e=document.getElementById("movehistory");e.scrollTop=e.scrollHeight}),[b.moveHistory]);var N,R,W=function(){h("isVolumeOn",b.isVolumeOn?"false":"true",{path:"/"}),E((function(e){e.isVolumeOn=!e.isVolumeOn}))},G=function(e){e.preventDefault(),E((function(e){e.showBackButtonWarning=!0}))};if(Object(a.useEffect)((function(){return window.history.pushState(null,null,window.location.pathname),window.addEventListener("popstate",G),function(){return window.removeEventListener("popstate",G)}})),4===b.lifeCycleStage){var L=Object(i.a)(b.moveHistory[b.viewIndex].timeLeft,2);N=L[0],R=L[1]}else{var M=me(b),I=Object(i.a)(b.moveHistory[M].timeLeft,2);N=I[0],R=I[1]}var B,H,z,P=l?[y.groundSize,y.wallWidth]:[y.smallScreenGroundSize,y.smallScreenWallWidth],_=Object(i.a)(P,2),V=_[0],q=_[1],J=Math.pow(1.1,b.zoomLevel-5),F=V*J,Y=q*J,Q=Y*(ce.h-1)/2+F*(ce.h+1)/2,te=Y*(ce.w-1)/2+F*(ce.w+1)/2,ne=l?15:6;if(l){B="".concat(100,"px ").concat(Q,"px"),H="".concat(te,"px ").concat(360,"px"),z="'timer status' 'board panel'"}else{B="".concat(50,"px ").concat(Q,"px ").concat(80,"px ").concat(Q,"px"),H="".concat(te,"px"),z="'timer' 'board' 'status' 'panel'"}return o.a.createElement("div",{className:c?"teal darken-4":void 0},o.a.createElement(K,{gameName:"Spectator"===m?"":b.joinCode,helpText:ee(),isLargeScreen:l,isDarkModeOn:c,handleToggleDarkMode:s}),o.a.createElement("div",{style:{display:"grid",gridTemplateRows:B,gridTemplateColumns:H,gridTemplateAreas:z,columnGap:"".concat(ne,"px"),rowGap:"".concat(ne,"px"),margin:"".concat(ne,"px"),justifyContent:"center",alignContent:"center"}},o.a.createElement($,{lifeCycleStage:b.lifeCycleStage,names:b.names,indexToMove:ue(b),playerColors:y.playerColors,timeLeft:[N,R],isLargeScreen:l,scores:b.gameWins}),o.a.createElement(Z,{lifeCycleStage:b.lifeCycleStage,names:b.names,indexToMove:ue(b),winner:b.winner,finishReason:b.finishReason,timeControl:b.timeControl,creatorStarts:b.creatorStarts,isLargeScreen:l}),o.a.createElement(U,{creatorToMove:de(b),playerColors:y.playerColors,grid:b.moveHistory[b.viewIndex].grid,playerPos:b.moveHistory[b.viewIndex].playerPos,goals:ie,ghostAction:b.ghostAction,premoveActions:b.premoveActions,handleClick:function(e){return S(e)},groundSize:F,wallWidth:Y,isDarkModeOn:c}),o.a.createElement(oe,{lifeCycleStage:b.lifeCycleStage,handleResign:function(){t.emit("resign"),E((function(e){Se(e,"Creator"===m)}))},handleOfferDraw:function(){t.emit("offerDraw")},handleRequestTakeback:function(){t.emit("requestTakeback")},handleGiveExtraTime:function(){t.emit("giveExtraTime"),E((function(e){Oe(e,"Creator"===m?1:0)}))},moveHistory:b.moveHistory,playerColors:y.playerColors,clientRole:m,creatorStarts:b.creatorStarts,handleViewMove:j,viewIndex:b.viewIndex,turnCount:me(b),handleSeeFirstMove:function(){j(0),document.getElementById("movehistory").scrollTop=0},handleSeePreviousMove:function(){return j(b.viewIndex-1)},handleSeeNextMove:function(){return j(b.viewIndex+1)},handleSeeLastMove:function(){j(me(b));var e=document.getElementById("movehistory");e.scrollTop=e.scrollHeight},handleToggleVolume:W,isVolumeOn:b.isVolumeOn,handleLeaveGame:k,isDarkModeOn:c,handleIncreaseBoardSize:function(){b.zoomLevel<10&&h("zoomLevel",b.zoomLevel+1,{path:"/"}),E((function(e){e.zoomLevel<10&&(e.zoomLevel+=1)}))},handleDecreaseBoardSize:function(){b.zoomLevel>0&&h("zoomLevel",b.zoomLevel-1,{path:"/"}),E((function(e){e.zoomLevel>0&&(e.zoomLevel-=1)}))},zoomLevel:b.zoomLevel,boardHeight:Q})),4===b.lifeCycleStage&&"Spectator"!==m&&o.a.createElement(w.Row,{className:"valign-wrapper",style:{marginTop:"1rem"}},o.a.createElement(w.Col,{className:"center",s:12},o.a.createElement(w.Button,{large:!0,className:"red",node:"button",waves:"light",onClick:function(){O("A rematch offer was sent to the opponent. A new game will start if they accept.",5e3),t.emit("offerRematch")},disabled:b.opponentLeft},"Rematch"))),o.a.createElement(X,{isOpen:b.showBackButtonWarning,title:"Return to lobby",body:"Are you sure you want to return to the lobby? You will not be able to rejoin this game.",acceptButtonText:"Quit game",rejectButtonText:"Stay in game",callback:function(e){e?(E((function(e){e.showBackButtonWarning=!1})),k()):E((function(e){e.showBackButtonWarning=!1}))}}),o.a.createElement(X,{isOpen:b.showDrawDialog,title:"Draw offer received",body:"The opponent offered a draw.",acceptButtonText:"Accept",rejectButtonText:"Decline",callback:function(e){e?(t.emit("acceptDraw"),E((function(e){ke(e,"agreement")}))):(t.emit("rejectDraw"),E((function(e){e.showDrawDialog=!1})))}}),o.a.createElement(X,{isOpen:b.showRematchDialog,title:"Rematch offer received",body:"The opponent would like a rematch.",acceptButtonText:"Accept",rejectButtonText:"Decline",callback:function(e){e?(t.emit("acceptRematch"),E((function(e){Te(e)}))):(t.emit("rejectRematch"),E((function(e){e.showRematchDialog=!1})))}}),o.a.createElement(X,{isOpen:b.showTakebackDialog,title:"Takeback request received",body:"The opponent requested a takeback. If you accept, their last move will be undone.",acceptButtonText:"Accept",rejectButtonText:"Decline",callback:function(e){e?(O("The last move played on the board has been undone.",5e3),t.emit("acceptTakeback"),E((function(e){xe(e,"Joiner"===m)}))):(t.emit("rejectTakeback"),E((function(e){e.showTakebackDialog=!1})))}}))},Ne=function(e){var t=e.playerName,n=e.handlePlayerName,r=e.duration,l=e.handleDuration,i=e.increment,c=e.handleIncrement,s=e.joinCode,m=e.handleJoinCode,d=e.handleCreateGame,u=e.handleJoinGame,f=e.handleRefreshName;Object(a.useEffect)((function(){return window.addEventListener("keydown",h),function(){window.removeEventListener("keydown",h)}}));var h=function(e){"Enter"===e.key&&(s.length>0?u():(O("Created new game",5e3),d()))};return o.a.createElement("div",{className:"container teal darken-2",style:{marginTop:"2rem"}},o.a.createElement(w.Row,{className:"valign-wrapper"},o.a.createElement(w.Col,{className:"center",s:5,m:4},o.a.createElement("h5",null,"Your name:")),o.a.createElement(w.Col,{s:5,m:3},o.a.createElement(w.TextInput,{id:"nameInput",value:t,onChange:n})),o.a.createElement(w.Col,{s:1,m:1},o.a.createElement(w.Button,{className:"teal lighten-2",node:"button",waves:"light",small:!0,floating:!0,style:{color:"white"},icon:o.a.createElement(w.Icon,null,"refresh"),onClick:f,tooltip:"Get a new name"})),o.a.createElement(w.Col,{s:1,m:4})),o.a.createElement(w.Row,{className:"valign-wrapper"},o.a.createElement(w.Col,{className:"center",s:5,m:4},o.a.createElement(w.Button,{node:"button",waves:"light",onClick:d},"Create game")),o.a.createElement(w.Col,{s:2,m:1,style:{paddingRight:"0"}},o.a.createElement(w.TextInput,{id:"durationInput",label:"Duration",value:"".concat(r),onChange:l})),o.a.createElement(w.Col,{s:1,m:1,style:{paddingLeft:"0"}},"m"),o.a.createElement(w.Col,{s:2,m:1,style:{paddingRight:"0"}},o.a.createElement(w.TextInput,{id:"incrementInput",label:"Increment",value:"".concat(i),onChange:c})),o.a.createElement(w.Col,{s:1,m:1,style:{paddingLeft:"0"}},"s"),o.a.createElement(w.Col,{s:1,m:4})),o.a.createElement(w.Row,{className:"valign-wrapper"},o.a.createElement(w.Col,{className:"center",s:5,m:4},o.a.createElement(w.Button,{node:"button",waves:"light",onClick:u},"Join game")),o.a.createElement(w.Col,{s:6,m:5},o.a.createElement(w.TextInput,{id:"joinInput",placeholder:"Write game code here...",value:"".concat(s),onChange:m})),o.a.createElement(w.Col,{s:1,m:3})))},De=function(){return o.a.createElement("div",null,o.a.createElement("h6",null,"This is the lobby. Here, you can create games that your friends can join, or join a friend's game. Click on the code to copy it to the clipboard."),o.a.createElement("h6",null,"When you create a game, you can choose the ",o.a.createElement("em",null,"duration")," (the time that each player has) and a time",o.a.createElement("em",null,"increment")," that is added to each player after they move."),o.a.createElement("h6",null,"Once you create a game, a ",o.a.createElement("em",null,"game code")," will appear in the top header. Share this code with your friend to play with them."),o.a.createElement("h6",null,'To join a friend\'s game, write the code they give you in the box next to the "Join game" button and click it.'),o.a.createElement("h6",null,"A random ",o.a.createElement("em",null,"username")," has been chosen for you, but you can change it."))},Re=function(e){var t=e.socket,n=e.isLargeScreen,r=e.isDarkModeOn,l=e.handleViewGame,c=Object(C.a)({game:null,nextMove:0,grid:D(y.boardDims),playerPos:y.initialPlayerPos,needToRequestGame:!0,finishedGameWait:3}),s=Object(i.a)(c,2),m=s[0],d=s[1];return Object(a.useEffect)((function(){var e=setInterval((function(){if(m.needToRequestGame)return d((function(e){e.needToRequestGame=!1})),void t.emit("getRandomGame");m.game&&(m.game.moveHistory?m.nextMove!==m.game.moveHistory.length?d((function(e){if(e.game&&e.game.moveHistory&&e.nextMove!==e.game.moveHistory.length){for(var t=e.nextMove%2===(e.game.creatorStarts?0:1)?0:1,n=e.game.moveHistory[e.nextMove].actions,a=0;a<n.length;a++){var o=n[a];"Ground"===j(o)?e.playerPos[t]=o:e.grid[o.r][o.c]=t+1}e.nextMove++}})):d((function(e){e.finishedGameWait>0?e.finishedGameWait--:(e.game=null,e.needToRequestGame=!0,e.finishedGameWait=3)})):console.log("Error: game does not have a move history"))}),2e3);return function(){return clearInterval(e)}})),Object(a.useEffect)((function(){t.on("requestedRandomGame",(function(e){var t=e.game;d((function(e){e.game=t,e.nextMove=0,e.grid=D(y.boardDims),e.playerPos=y.initialPlayerPos}))}))}),[t,d,m.needToRequestGame]),o.a.createElement(U,{creatorToMove:!1,playerColors:y.playerColors,grid:m.grid,playerPos:m.playerPos,goals:y.goals,ghostAction:null,premoveActions:[],handleClick:function(){return l(m.game._id)},groundSize:n?y.groundSize:y.smallScreenGroundSize,wallWidth:n?y.wallWidth:y.smallScreenWallWidth,isDarkModeOn:r})},We={position:"sticky",top:"0px",paddingTop:"0.15rem",paddingBottom:"0.15rem",borderRadius:"0"},Ge={paddingTop:"0.15rem",paddingBottom:"0.15rem",borderRadius:"0"},Ae=function(e){return Math.round(100*(e+Number.EPSILON))/100},Le=function(e){return Ae(e.duration)+"+"+Ae(e.increment)};function Me(e,t){if(!e)return"-";var n=(new Date).getTime(),a=new Date(e).getTime(),o=Math.floor((n-a)/1e3),r=Math.floor(o/2592e3);return r>1?e.toDateString.substring(4,10):1===(r=Math.floor(o/86400))?t?"1 day ago":"1d ago":r>1?r+(t?" days":"d")+" ago":1===(r=Math.floor(o/3600))?t?"1 hour ago":"1h ago":r>1?r+(t?" hours":"h")+" ago":1===(r=Math.floor(o/60))?t?"1 minute ago":"1m ago":r>1?r+(t?" minutes":"m")+" ago":"Just now"}var Ie=function(e){var t=e.socket,n=e.isLargeScreen,r=e.isDarkModeOn,l=e.handleViewGame,c=Object(a.useState)(null),s=Object(i.a)(c,2),m=s[0],d=s[1],u=Object(a.useState)(!0),f=Object(i.a)(u,2),h=f[0],g=f[1];return Object(a.useEffect)((function(){h&&(g(!1),t.emit("getRecentGames"))}),[t,h]),Object(a.useEffect)((function(){t.on("requestedRecentGames",(function(e){var t=e.games;d(t)}))}),[t,h]),m?n?o.a.createElement("div",{className:"center",style:{overflowY:"scroll",display:"block",height:"100%",border:"1px solid #00796d"}},o.a.createElement(w.Table,{centered:!0,style:{width:"100%"}},o.a.createElement("thead",null,o.a.createElement("tr",null,o.a.createElement("th",{className:"teal darken-2",style:We},"Time"),o.a.createElement("th",{className:"teal darken-2",style:We},"Player 1"),o.a.createElement("th",{className:"teal darken-2",style:We},"Final Distance"),o.a.createElement("th",{className:"teal darken-2",style:We},"Player 2"),o.a.createElement("th",{className:"teal darken-2",style:We},"Turns"),o.a.createElement("th",{className:"teal darken-2",style:We},"Date"))),o.a.createElement("tbody",null,m&&m.map((function(e,t){var n="red";return n+=r?" darken-":" lighten-",n+=1+t%2,o.a.createElement("tr",{onClick:function(){return l(e._id)},style:{cursor:"pointer"},key:t,className:n},o.a.createElement("td",{style:Ge},Le(e.timeControl)),o.a.createElement("td",{style:Ge},e.playerNames[0]),o.a.createElement("td",{style:Ge},function(e){for(var t=D(y.boardDims),n=E()(y.initialPlayerPos),a=e.creatorStarts?0:1,o=0;o<e.moveHistory.length;o++){for(var r=e.moveHistory[o].actions,l=0;l<r.length;l++){var c=r[l];"Ground"===j(c)?n[a]=c:t[c.r][c.c]=a+1}a=(a+1)%2}var s=Object(i.a)(y.goals,2),m=s[0],d=s[1],u=[A(t,n[0],m),A(t,n[1],d)];return u[0]+" - "+u[1]}(e)),o.a.createElement("td",{style:Ge},e.playerNames[1]),o.a.createElement("td",{style:Ge},e.moveHistory.length),o.a.createElement("td",{style:Ge},Me(e.startDate,!0)))}))))):o.a.createElement("div",{className:"center",style:{overflowY:"scroll",display:"block",height:"100%",border:"1px solid #00796d"}},o.a.createElement(w.Table,{centered:!0,style:{width:"100%"}},o.a.createElement("thead",null,o.a.createElement("tr",null,o.a.createElement("th",{className:"teal darken-2",style:We},"Time"),o.a.createElement("th",{className:"teal darken-2",style:We},"Player 1"),o.a.createElement("th",{className:"teal darken-2",style:We},"Win"),o.a.createElement("th",{className:"teal darken-2",style:We},"Player 2"),o.a.createElement("th",{className:"teal darken-2",style:We},"Date"))),o.a.createElement("tbody",null,m&&m.map((function(e,t){var n,a="red";return a+=r?" darken-":" lighten-",a+=1+t%2,o.a.createElement("tr",{onClick:function(){return l(e._id)},style:{cursor:"pointer"},key:t,className:a},o.a.createElement("td",{style:Ge},Le(e.timeControl)),o.a.createElement("td",{style:Ge},e.playerNames[0]),o.a.createElement("td",{style:Ge},"creator"===(n=e).winner?"<":"draw"===n.winner?"=":">"),o.a.createElement("td",{style:Ge},e.playerNames[1]),o.a.createElement("td",{style:Ge},Me(e.startDate,!1)))}))))):o.a.createElement("div",null)},Be=function(){return Object(f.b)({dictionaries:[f.a],length:1}).slice(0,9)},He=function(e){var t=e.socket,n=Object(p.a)(["playerName","duration","increment","isDarkModeOn"]),r=Object(i.a)(n,2),l=r[0],c=r[1],s=Object(a.useState)(l.playerName||Be()),m=Object(i.a)(s,2),d=m[0],u=m[1],f=Object(a.useState)(l.duration||5),v=Object(i.a)(f,2),w=v[0],b=v[1],E=Object(a.useState)(l.increment||5),C=Object(i.a)(E,2),k=C[0],S=C[1],x=Object(a.useState)(""),T=Object(i.a)(x,2),j=T[0],N=T[1],D=Object(a.useState)(!1),R=Object(i.a)(D,2),W=R[0],G=R[1],A=Object(a.useState)(null),L=Object(i.a)(A,2),M=L[0],I=L[1],B=Object(a.useState)(!(!l.isDarkModeOn||"true"!==l.isDarkModeOn)),H=Object(i.a)(B,2),z=H[0],P=H[1],_=function(e){I({clientRole:"Spectator",gameId:e}),G(!0)},V=function(){c("isDarkModeOn",z?"false":"true",{path:"/"}),P(!z)};Object(a.useEffect)((function(){var e="#004d40",t="#009688";document.body.style.backgroundColor=z?e:t}),[z]);var q,J,F,U=Object(h.useMediaQuery)({query:"(min-width: 990px)"}),Y=y.boardDims,Q=U?[y.groundSize,y.wallWidth]:[y.smallScreenGroundSize,y.smallScreenWallWidth],X=Object(i.a)(Q,2),Z=X[0],$=X[1],ee=$*(Y.h-1)/2+Z*(Y.h+1)/2,te=$*(Y.w-1)/2+Z*(Y.w+1)/2,ne=U?15:6;return Object(h.useMediaQuery)({query:"(min-width: 1300px)"})?(q="".concat(40,"px ").concat(ee,"px"),J="".concat(te,"px ").concat(te,"px"),F="'showcaseTitle recentTitle' 'gameShowcase recentGameList'"):(q="".concat(40,"px ").concat(ee,"px ").concat(40,"px ").concat(ee,"px"),J="".concat(te,"px"),F="'showcaseTitle' 'gameShowcase' 'recentTitle' 'recentGameList'"),o.a.createElement("div",{style:{paddingBottom:"2rem"}},o.a.createElement(g.b,null),W&&o.a.createElement(je,{socket:t,clientParams:M,returnToLobby:function(){G(!1),I(null),N("")},isLargeScreen:U,isDarkModeOn:z,handleToggleDarkMode:V}),!W&&o.a.createElement("div",null,o.a.createElement(K,{gameName:"",helpText:De(),isLargeScreen:U,isDarkModeOn:z,handleToggleDarkMode:V}),o.a.createElement(Ne,{playerName:d,handlePlayerName:function(e){u(e.target.value.slice(0,9))},duration:w,handleDuration:function(e){return b(e.target.value)},increment:k,handleIncrement:function(e){return S(e.target.value)},joinCode:j,handleJoinCode:function(e){return N(e.target.value)},handleCreateGame:function(){var e=[parseFloat(w),parseFloat(k)],t=e[0],n=e[1];isNaN(t)||t<.1?(t=5/60,O("Invalid duration, using 5s instead",5e3)):t>120?(t=120,O("Duration too long, using 2h instead",5e3)):c("duration",t,{path:"/"}),isNaN(n)||n<0?(n=0,O("Invalid increment, using 0s instead",5e3)):n>300?(n=300,O("Increment too large, using 5m instead",5e3)):c("increment",n,{path:"/"});var a=d;""===a?a="Anon":c("playerName",a,{path:"/"}),I({clientRole:"Creator",timeControl:{duration:t,increment:n},creatorName:a}),G(!0)},handleJoinGame:function(){var e=d;""===e?e="Anon":c("playerName",e,{path:"/"}),I({clientRole:"Joiner",joinCode:j,joinerName:e}),G(!0)},handleRefreshName:function(){u(Be())}}),o.a.createElement("div",{style:{display:"grid",gridTemplateRows:q,gridTemplateColumns:J,gridTemplateAreas:F,columnGap:"".concat(2*ne,"px"),rowGap:"".concat(ne,"px"),margin:"".concat(ne,"px"),justifyContent:"center",alignContent:"center"}},o.a.createElement("div",{style:{gridArea:"showcaseTitle",alignSelf:"center",justifySelf:"center",fontSize:"20px"},title:"Random games already played"},"Game Showcase"),o.a.createElement("div",{style:{gridArea:"gameShowcase"}},o.a.createElement(Re,{socket:t,isLargeScreen:U,isDarkModeOn:z,handleViewGame:_})),o.a.createElement("div",{style:{gridArea:"recentTitle",alignSelf:"center",justifySelf:"center",fontSize:"20px"}},"Recent games"),o.a.createElement("div",{style:{gridArea:"recentGameList"}},o.a.createElement(Ie,{socket:t,isLargeScreen:U,isDarkModeOn:z,handleViewGame:_})))))},ze=function(){console.log("connecting to backend at ".concat("https://wallwars.herokuapp.com/"));var e=Object(a.useState)(d()("https://wallwars.herokuapp.com/")),t=Object(i.a)(e,1)[0];return o.a.createElement(o.a.StrictMode,null,o.a.createElement(u.a,null,o.a.createElement(c.a,null,o.a.createElement(s.d,null,o.a.createElement(s.b,{path:"/wallwars/index.html",exact:!0},o.a.createElement(He,{socket:t})),o.a.createElement(s.a,{to:"/wallwars/index.html"})))))};l.a.render(o.a.createElement(ze,null),document.getElementById("root"))},70:function(e,t,n){e.exports=n.p+"static/media/moveSound.6df49e4b.mp3"},75:function(e,t,n){e.exports=n(165)},80:function(e,t,n){}},[[75,1,2]]]);
//# sourceMappingURL=main.3f04db7f.chunk.js.map