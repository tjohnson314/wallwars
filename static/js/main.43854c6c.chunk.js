(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{110:function(e,t){},165:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(12),l=n.n(r),i=(n(80),n(4)),c=n(71),s=n(5),u=n(65),m=n.n(u),d=n(169),f=n(43),h=n(66),g=n(21),p=n(168),y=n(3),v=n(16),w=n.n(v),b=n(73),E=n(67),k=n.n(E),C=n(68),x=n.n(C),T=function(e,t){t&&0!==t||(t=2500),Object(g.c)(e,{autoClose:t,hideProgressBar:!0,transition:g.a,pauseOnFocusLoss:!1})};function S(e){return e.r%2===0&&e.c%2===0?"Ground":e.r%2===0&&e.c%2===1||e.r%2===1&&e.c%2===0?"Wall":"Pillar"}function O(e,t){return e.r===t.r&&e.c===t.c}function j(e,t){return e.r>=0&&e.r<t.h&&e.c>=0&&e.c<t.w}function N(e,t){return"Wall"===S(t)&&0!==e[t.r][t.c]}function I(e,t){var n=function(e){return{h:e.length,w:e[0].length}}(e);if("Ground"!==S(t))return[];for(var a=[{r:0,c:1},{r:0,c:-1},{r:1,c:0},{r:-1,c:0}],o=[],r=[t.r,t.c],l=r[0],i=r[1],c=0;c<a.length;c++){var s=[a[c].r,a[c].c],u=s[0],m=s[1],d={r:l+u,c:i+m},f={r:l+2*u,c:i+2*m};j(f,n)&&!N(e,d)&&o.push(f)}return o}function D(e,t,n){if(O(t,n))return 0;var a=e[0].length,o=function(e){return e.r*a+e.c},r=[],l=0;r.push(t);var i=new Map;for(i.set(o(t),0);l<r.length;){var c=r[l];l+=1;for(var s=I(e,c),u=0;u<s.length;u++){var m=s[u];if(!i.has(o(m))){if(i.set(o(m),i.get(o(c))+1),O(m,n))return i.get(o(m));r.push(m)}}}return-1}function R(e,t,n,a){if(O(t,n))return 0;var o=e[0].length,r=function(e){return e.r*o+e.c},l=[],i=0;l.push(t);var c=new Map;for(c.set(r(t),0);i<l.length;){var s=l[i];i+=1;var u=c.get(r(s));if(u>a)return!1;for(var m=I(e,s),d=0;d<m.length;d++){var f=m[d];if(!c.has(r(f))){if(O(f,n))return u+1<=a;c.set(r(f),u+1),l.push(f)}}}return!1}function A(e,t,n){return-1!==D(e,t,n)}function L(e,t,n,a){if(N(e,a))return!1;e[a.r][a.c]=1;var o=function(e,t,n){for(var a=0;a<t.length;a++)if(!A(e,t[a],n[a]))return!1;return!0}(e,t,n);return e[a.r][a.c]=0,o}var B=n(69),M=n.n(B),W="#d2d2d2",G="#fbe4D6",H="#eaeaea",z="#f1bfa0",P="#cccccc",_=["face","outlet"],V="1px solid #00796d",J=function(e){for(var t=e.grid,n=e.ghostAction,r=Object(i.a)(e.playerColors,2),l=r[0],c=r[1],s=Object(i.a)(e.playerPos,2),u=s[0],m=s[1],d=Object(i.a)(e.goals,2),f=d[0],h=d[1],g=e.handleClick,p=e.creatorToMove,y=e.groundSize,v=e.wallWidth,w=e.isDarkModeOn,b=t.length,E=t[0].length,k=[],C=0;C<b;C++)for(var x=0;x<E;x++)k[C*E+x]={r:C,c:x};var T=Object(i.a)(_,2),j=T[0],N=T[1],I=(b-1)/2,D=(E-1)/2,R=Object(a.useState)(null),A=Object(i.a)(R,2),L=A[0],B=A[1],J=function(){B(null)},q=.8*y;return o.a.createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(".concat(D,", ").concat(y,"px ").concat(v,"px) ").concat(y,"px"),gridTemplateRows:"repeat(".concat(I,", ").concat(y,"px ").concat(v,"px) ").concat(y,"px"),justifyContent:"center",gridArea:"board"}},k.map((function(e){var a,r=[O(e,u),O(e,m)],i=r[0],s=r[1],d=[O(e,f),O(e,h)],y=d[0],v=d[1],k=null!==n&&O(n,e),C=k&&p,x=k&&!p,T=S(e);a="Ground"===T?L&&O(e,L)?G:W:"Wall"===T?L&&O(e,L)?z:H:P,w&&(a=M()(a));var I="";"Ground"===T&&(I+=" waves-effect waves-light"),"Wall"===T&&(I+=" waves-effect waves-dark");var D=i||s||C||x;if((y||v)&&(I=y?l:c,I+=w?" darken-4":" lighten-4"),"Wall"===T){var R=0!==t[e.r][e.c];(R||k)&&(R?(I=1===t[e.r][e.c]?l:c,I+=w?"":" darken-3"):(I=p?l:c,I+=w?" lighten-2":" lighten-3"))}return o.a.createElement("div",{className:I,key:"cell_".concat(e.r,"_").concat(e.c),onClick:function(){"Pillar"!==T&&g(e)},onMouseEnter:function(){return function(e){B(e)}(e)},onMouseLeave:J,style:{backgroundColor:a,display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",borderTop:0===e.r?V:"",borderBottom:e.r===b-1?V:"",borderLeft:0===e.c?V:"",borderRight:e.c===E-1?V:""}},i&&o.a.createElement("i",{className:"material-icons ".concat(l,"-text"),style:{fontSize:"".concat(q,"px")}},j),s&&o.a.createElement("i",{className:"material-icons ".concat(c,"-text"),style:{fontSize:"".concat(q,"px")}},N),y&&!D&&o.a.createElement("i",{className:"material-icons white-text",style:{fontSize:"".concat(q,"px")}},j),v&&!D&&o.a.createElement("i",{className:"material-icons white-text",style:{fontSize:"".concat(q,"px")}},N),C&&"Ground"===T&&o.a.createElement("i",{className:"material-icons ".concat(l,"-text text-lighten-4"),style:{fontSize:"".concat(q,"px")}},j),x&&"Ground"===T&&o.a.createElement("i",{className:"material-icons ".concat(c,"-text text-lighten-4"),style:{fontSize:"".concat(q,"px")}},N))})))},q=(n(158),n(70)),F=(n(162),function(e){var t,n=e.icon,a=e.tooltip,r=e.onClick,l=e.modalTitle,i=e.modalBody,c=e.modalConfirmButtonText,s=e.bgColor,u=e.padding,m=e.disabled;if(!i)return o.a.createElement(y.Button,{className:"teal",node:"button",waves:"light",icon:o.a.createElement(y.Icon,{className:"large"},n),onClick:r,tooltip:a,disabled:m});t=c&&""!==c?[o.a.createElement(y.Button,{style:{backgroundColor:"#009688",color:"white",marginRight:"1rem"},flat:!0,modal:"close",node:"button",waves:"green",onClick:r},c),o.a.createElement(y.Button,{style:{backgroundColor:"#009688",color:"white"},flat:!0,modal:"close",node:"button",waves:"green"},"Cancel")]:o.a.createElement(y.Button,{style:{backgroundColor:"#009688",color:"white"},flat:!0,modal:"close",node:"button",waves:"green"},"Close");var d=o.a.createElement(y.Button,{style:{padding:"0px ".concat(u,"px")},className:s||"teal",node:"button",waves:"light",icon:o.a.createElement(y.Icon,{className:"large"},n),tooltip:a,disabled:m});return o.a.createElement(y.Modal,{style:{color:"black",backgroundColor:"white"},bottomSheet:!1,fixedFooter:!1,header:l,open:!1,options:{dismissible:!0,endingTop:"10%",inDuration:250,opacity:.4,outDuration:250,preventScrolling:!0,startingTop:"4%"},trigger:d,actions:t},o.a.createElement("div",null,i))});var Y=function(e){var t,n=e.gameName,a=e.showLobby,r=e.endGame,l=e.helpText,i=e.isLargeScreen,c=e.isDarkModeOn;t=n?o.a.createElement("span",null,i&&o.a.createElement("span",null,"WallWars\xa0\xa0"),o.a.createElement(q.CopyToClipboard,{style:{cursor:"pointer"},text:n,onCopy:function(){return T("Game code copied to clipboard!")}},o.a.createElement("span",null,"Game ",n))):o.a.createElement("span",null,"WallWars");var s=o.a.createElement("div",null,o.a.createElement("h6",null,"Wallwars is an online 2-player strategy game. The goal is to get to your goal before the opponent gets to hers, building walls to reshape the terrain to your advantage."),o.a.createElement("h6",null,"It is implemented by Nil M and inspired by a board game he played once as a kid, of which he doesn't remember the name, unfortunately."),o.a.createElement("h6",null,"The frontend is made with React, and the backend with Node.js, Express, and socket.io."),o.a.createElement("h6",null,"The source code is available at https://github.com/nmamano/WallWars")),u=c?"red darken-4":"red lighten-1",m=i?20:11;return o.a.createElement("div",null,o.a.createElement("div",{className:u,style:{height:"50px",display:"grid",gridTemplateRows:"1fr",gridTemplateColumns:"auto auto",justifyContent:"space-between",alignItems:"center"}},o.a.createElement("div",{style:{fontSize:i?"30px":"25px",marginLeft:i?"15px":"5px"}},t),o.a.createElement("div",{style:{height:"auto",display:"grid",padding:"5px",gridTemplateColumns:"repeat(3, 1fr)",gridTemplateRows:"auto",columnGap:"5px",rowGap:"5px",marginRight:i?"15px":"5px"}},a?o.a.createElement(F,{icon:"home",tooltip:"Quit game",onClick:r,modalTitle:"Return to lobby",modalBody:"Are you sure you want to return to the lobby? You will not be able to rejoin this game.",modalConfirmButtonText:"Quit game",bgColor:"red darken-1",padding:m}):o.a.createElement("div",null),o.a.createElement(F,{icon:"help",tooltip:"Help",modalTitle:"Help",modalBody:l,bgColor:"red darken-1",padding:m}),o.a.createElement(F,{icon:"info",tooltip:"About",modalTitle:"About",modalBody:s,bgColor:"red darken-1",padding:m}))))},K=function(e){var t=e.title,n=e.body,a=e.acceptButtonText,r=e.rejectButtonText,l=e.isOpen,i=e.callback;return o.a.createElement(y.Modal,{style:{color:"black",backgroundColor:"white"},header:t,open:l,options:{dismissible:!1,endingTop:"10%",inDuration:250,opacity:.4,outDuration:250,preventScrolling:!0,startingTop:"4%"},actions:[o.a.createElement(y.Button,{style:{backgroundColor:"#009688",color:"white",marginRight:"1rem"},flat:!0,modal:"close",node:"button",waves:"green",onClick:function(){i(!0)}},a||"Accept"),o.a.createElement(y.Button,{style:{backgroundColor:"#009688",color:"white"},flat:!0,modal:"close",node:"button",waves:"green",onClick:function(){i(!1)}},r||"Cancel")]},o.a.createElement("div",null,n))},Q=function(e){var t,n=e.names,a=e.lifeCycleStage,r=e.winner,l=e.finishReason,i=e.indexToMove,c=e.timeControl,s=e.creatorStarts,u=e.isLargeScreen,m=n[i];switch(a){case-2:t="Haven't tried to connect to the server yet";break;case-1:t="Waking the server up...";break;case 0:t="Waiting for player 2 to join";break;case 1:t="".concat(m," starts");break;case 2:case 3:t="".concat(m," to move");break;case 4:t="draw"===r?"The game ended in a draw "+{goal:"by the 1-move rule",agreement:"by agreement"}[l]:"".concat(n["creator"===r?0:1]," won ").concat({time:"on time",goal:"by reaching the goal",resign:"by resignation",disconnect:"by disconnection"}[l]);break;default:console.error("stage should be in range [-2..4]")}var d=function(e){return Math.round(100*(e+Number.EPSILON))/100};return o.a.createElement("div",{className:"teal darken-2",style:{display:"grid",gridTemplateColumns:"auto",gridTemplateRows:"1fr 1fr 1fr",alignItems:"center",padding:u?"15px 15px":"5px 15px",gridArea:"status"}},o.a.createElement("div",null,o.a.createElement("p",null,t)),o.a.createElement("div",null,c&&o.a.createElement("p",null,"Time control: ",d(c.duration),"+",d(c.increment))),o.a.createElement("div",null,o.a.createElement("p",null,"First move:"+(a>1?" ".concat(n[s?0:1]):""))))},U=function(e){var t=e.lifeCycleStage,n=e.names,a=e.playerColors,r=e.timeLeft,l=e.indexToMove,i=e.isLargeScreen,c=e.scores,s=[Math.floor(r[0]/60),Math.floor(r[1]/60)],u=s[0],m=s[1],d=r[0]%60,f=r[1]%60,h=["".concat(u,":").concat(d<10?"0":"").concat(d),"".concat(m,":").concat(f<10?"0":"").concat(f)];t<0&&(h[0]="_:__",h[1]="_:__");var g=["",""];if(t<4){g[l]=a[l]+" lighten-1 z-depth-2"}var p=["",""];3===t&&(0===l?r[0]<15&&(p[0]=" orange lighten-2 z-depth-2"):1===l&&r[1]<15&&(p[1]=" orange lighten-2 z-depth-2"));var y,v=0!==c[0]||0!==c[1],w={padding:y=i&&!v?"15px":i&&v?"12px":i||v?"6px":"8px",fontSize:i?"18px":"14px"};return o.a.createElement("div",{className:"teal darken-2",style:{display:"grid",gridTemplateColumns:v?"0.5fr 1.7fr 1fr 1fr 1.7fr 0.5fr":"1.7fr 1fr 1fr 1.7fr",gridTemplateRows:"auto",alignContent:"center",columnGap:y,padding:y,gridArea:"timer"}},v&&o.a.createElement("div",{style:w,className:"center"},c[0]),o.a.createElement("div",{style:w,className:g[0]+" center truncate"},n[0]),o.a.createElement("div",{style:w,className:p[0]+" center"},h[0]),o.a.createElement("div",{style:w,className:p[1]+" center"},h[1]),o.a.createElement("div",{style:w,className:g[1]+" center truncate"},null===n[1]?"______":n[1]),v&&o.a.createElement("div",{style:w,className:"center"},c[1]))},X=function(){return o.a.createElement("div",null,o.a.createElement("h6",null,'To connect with your friend, share the game code in the top header with them and tell them to use it when clicking "Join Game" from the lobby. Click on the code to copy it to the clipboard.'),o.a.createElement("h6",null,"Rules of the game:"),o.a.createElement("h6",null,"The player who created the game starts at the top left corner (color red). The player who joined the game starts at the top right (color blue). The goal of each player is to reach the ",o.a.createElement("em",null,"opposite")," corner from where they start. The player who gets there first, wins."),o.a.createElement("h6",null,"Players move by clicking cells on the board. There are two types of cells: ground cells (the big squares) and walls (the thin rectangles in between ground cells). Each move consists of a total of two actions. One action can be building one wall or moving to an adjacent cell (a diagonal move counts as two actions)."),o.a.createElement("h6",null,"Players can build walls to obstruct the opponent. Walls can be built anywhere as long as there always exists at least one way to get to their goal."),o.a.createElement("h6",null,"The remaining time for each player is shown next to their name. The clock of a player ticks down when it is their turn (after each player has moved once). The player who starts is chosen randomly. The name of the player to move next is highlighted with their color."),o.a.createElement("h6",null,"If it is your turn and you do a single action, like building a wall or moving to an adjacent cell, you can undo it by clicking the wall again or clicking a different ground cell, respectively. Once you choose 2 actions, the move becomes permanent."),o.a.createElement("h6",null,"Special rules:"),o.a.createElement("h6",null,"(1) no walls can be placed during the first move of each player."),o.a.createElement("h6",null,"(2) if the player who moved first reaches the goal first but the other player is at distance 1 or 2 from her goal, the game ends in a draw."),o.a.createElement("h6",null,"Note: if you return to the lobby, you will not be able to reenter this game!"))},Z=function(e){var t=e.moveHistory,n=e.playerColors,a=e.creatorStarts,r=e.handleViewMove,l=e.viewIndex,i=e.height,c={position:"sticky",top:"0px",paddingTop:"0.15rem",paddingBottom:"0.15rem",borderRadius:"0"},s={paddingTop:"0.15rem",paddingBottom:"0.15rem",borderRadius:"0"};return o.a.createElement("div",{id:"movehistory",className:"center",style:{overflowY:"scroll",display:"block",height:i}},o.a.createElement(y.Table,{centered:!0,style:{width:"100%"}},o.a.createElement("thead",null,o.a.createElement("tr",null,o.a.createElement("th",{className:"teal darken-2",style:c},"Move"),o.a.createElement("th",{className:"teal darken-2",style:c},"Actions"),o.a.createElement("th",{className:"teal darken-2",style:c},"Distance"),o.a.createElement("th",{className:"teal darken-2",style:c},"# Walls"))),o.a.createElement("tbody",null,t.map((function(e,i){var c;return 0===i?c=void 0:(c=a?n[(i+1)%2]:n[i%2],c+=" lighten-2"),l===i&&i<t.length-1&&(c="amber darken-1"),o.a.createElement("tr",{onClick:function(){return r(i)},style:{cursor:"pointer"},key:i,className:c},o.a.createElement("td",{style:s},i),o.a.createElement("td",{style:s},function(e){if(0===e.index)return"__";for(var t=0,n=0;n<e.actions.length;n++){"Wall"===S(e.actions[n])&&(t+=1)}return 0===t?"GG":1===t?"GW":"WW"}(e)),o.a.createElement("td",{style:s},e.distances[0]+" - "+e.distances[1]),o.a.createElement("td",{style:s},e.wallCounts[0]+" - "+e.wallCounts[1]))})))))},$=function(e){var t=e.lifeCycleStage,n=e.handleResign,a=e.handleOfferDraw,r=e.handleRequestTakeback,l=e.handleGiveExtraTime,i=e.moveHistory,c=e.playerColors,s=e.creatorStarts,u=e.handleViewMove,m=e.viewIndex,d=e.handleSeeFirstMove,f=e.handleSeePreviousMove,h=e.handleSeeNextMove,g=e.handleSeeLastMove,p=e.handleToggleVolume,y=e.isVolumeOn,v=e.handleToggleDarkMode,w=e.isDarkModeOn,b=e.handleIncreaseBoardSize,E=e.handleDecreaseBoardSize,k=e.zoomLevel,C=e.boardHeight-108-15-10;return o.a.createElement("div",{className:"teal darken-2",style:{width:"100%",height:"auto",display:"grid",padding:"".concat(5,"px"),gridTemplateColumns:"repeat(4, 1fr)",gridTemplateRows:"".concat(36,"px 1fr ").concat(36,"px ").concat(36,"px"),columnGap:"".concat(5,"px"),rowGap:"".concat(5,"px"),gridArea:"panel"}},o.a.createElement(F,{icon:"flag",tooltip:"Resign",modalTitle:"Resign",modalBody:"Are you sure you want to resign?",modalConfirmButtonText:"Resign",onClick:n,disabled:3!==t}),o.a.createElement(F,{icon:"local_florist",tooltip:"Offer Draw",modalTitle:"Offer Draw",modalBody:"Are you sure you want to offer a draw?",modalConfirmButtonText:"Offer draw",onClick:a,disabled:3!==t}),o.a.createElement(F,{icon:"replay",tooltip:"Propose takeback",onClick:function(){T("A takeback request was sent to the opponent. If they accept, the last move will be undone.",5e3),r()},disabled:3!==t&&2!==t}),o.a.createElement(F,{icon:"add_alarm",tooltip:"Give 60 seconds",onClick:function(){T("You added 60s to the opponent's clock.",5e3),l()},disabled:3!==t}),o.a.createElement("div",{style:{gridColumnStart:"1",gridColumnEnd:"5"}},o.a.createElement(Z,{moveHistory:i,playerColors:c,creatorStarts:s,handleViewMove:u,viewIndex:m,height:C})),o.a.createElement(F,{icon:"fast_rewind",onClick:d,disabled:t<=1}),o.a.createElement(F,{icon:"navigate_before",onClick:f,disabled:t<=1}),o.a.createElement(F,{icon:"navigate_next",onClick:h,disabled:t<=1}),o.a.createElement(F,{icon:"fast_forward",onClick:g,disabled:t<=1}),o.a.createElement(F,{icon:y?"volume_up":"volume_off",tooltip:y?"Turn off sound effects":"Turn on sound effects",onClick:p}),o.a.createElement(F,{icon:w?"brightness_2":"brightness_4",tooltip:w?"Turn off dark mode":"Turn on dark mode",onClick:v}),o.a.createElement(F,{icon:"zoom_out",tooltip:"Decrease board size",onClick:E,disabled:0===k}),o.a.createElement(F,{icon:"zoom_in",tooltip:"Increase board size",onClick:b,disabled:10===k}))},ee=new k.a(x.a),te={w:23,h:19},ne={tl:{r:0,c:0},tr:{r:0,c:te.w-1},bl:{r:te.h-1,c:0},br:{r:te.h-1,c:te.w-1}},ae=[ne.tl,ne.tr],oe=[ne.br,ne.bl],re=["red","indigo"],le="#004d40",ie="#009688",ce=function(e){return e.moveHistory.length-1},se=function(e){return ce(e)%2===(e.creatorStarts?0:1)},ue=function(e){return se(e)?0:1},me=function(e){for(var t=[],n=0;n<e.h;n++){t[n]=[];for(var a=0;a<e.w;a++)t[n][a]=0}return t},de=function(e){return null===e?"None":S(e)},fe=function(e,t,n,a){if(!(e.lifeCycleStage<1||e.lifeCycleStage>3)){var o=ce(e);if(o===n-1){e.isVolumeOn&&ee.play();var r=ue(e),l=0===r?1:0,i=w()(e.moveHistory[o].playerPos),c=w()(e.moveHistory[o].grid),s=w()(e.moveHistory[o].timeLeft),u=w()(e.moveHistory[o].wallCounts);s[r]=a;for(var m=0;m<t.length;m++){var d=t[m],f=S(d);if("Ground"===f){if(i[r]=d,O(d,oe[r])){var h=o%2===0,g=R(c,i[l],oe[l],2);h&&g?(e.winner="draw",e.gameWins[0]+=.5,e.gameWins[1]+=.5):(e.winner=0===r?"creator":"joiner",e.gameWins[r]+=1),e.finishReason="goal",e.lifeCycleStage=4}}else"Wall"===f?(c[d.r][d.c]=r+1,u[r]+=1):console.error("unexpected action type",f)}e.moveHistory.push({index:o+1,actions:t,grid:c,playerPos:i,timeLeft:s,distances:[D(c,i[0],oe[0]),D(c,i[1],oe[1])],wallCounts:u}),1===e.lifeCycleStage&&0===o?e.lifeCycleStage=2:2===e.lifeCycleStage&&1===o&&(e.lifeCycleStage=3),e.ghostAction=null,e.viewIndex=o+1}}},he=function(e){e.showRematchDialog=!1,e.showDrawDialog=!1,e.showTakebackDialog=!1},ge=function(e,t){3===e.lifeCycleStage&&(e.isVolumeOn&&ee.play(),e.lifeCycleStage=4,e.winner="draw",e.gameWins[0]+=.5,e.gameWins[1]+=.5,e.finishReason=t,e.ghostAction=null,he(e))},pe=function(e,t){3===e.lifeCycleStage&&(e.lifeCycleStage=4,e.winner=t?"joiner":"creator",e.gameWins[t?1:0]+=1,e.finishReason="resign",e.ghostAction=null,he(e))},ye=function(e){if(e.showTakebackDialog=!1,2===e.lifeCycleStage||3===e.lifeCycleStage){e.moveHistory.pop(),e.ghostAction=null;var t=ce(e);e.viewIndex=t,0===t?e.lifeCycleStage=1:1===t&&(e.lifeCycleStage=2)}},ve=function(e){if(4===e.lifeCycleStage){e.creatorStarts=!e.creatorStarts;var t=me(te);e.moveHistory=[{index:0,actions:[],grid:t,playerPos:ae,timeLeft:[60*e.timeControl.duration,60*e.timeControl.duration],distances:[D(t,ae[0],oe[0]),D(t,ae[1],oe[1])],wallCounts:[0,0]}],e.winner="",e.finishReason="",e.lifeCycleStage=1,e.viewIndex=0,e.ghostAction=null,he(e)}},we=function(e,t){if(3===e.lifeCycleStage){var n=ce(e);e.moveHistory[n].timeLeft[t]+=60}},be=function(e){var t=e.socket,n=e.creatorParams,r=e.joinerParams,l=e.returnToLobby,c=e.isLargeScreen,s=null!==n,u=Object(b.a)({gameId:s?null:r.gameId,timeControl:s?n.timeControl:null,names:[s?n.creatorName:null,s?null:r.joinerName],gameWins:[0,0],opponentLeft:!1,creatorStarts:null,winner:"",finishReason:"",lifeCycleStage:-2,moveHistory:[{index:0,actions:[],grid:me(te),playerPos:ae,timeLeft:[s?60*n.timeControl.duration:null,s?60*n.timeControl.duration:null],distances:[D(me(te),ae[0],oe[0]),D(me(te),ae[1],oe[1])],wallCounts:[0,0]}],ghostAction:null,isVolumeOn:!1,isDarkModeOn:!1,showBackButtonWarning:!1,isKeyPressed:!1,viewIndex:0,zoomLevel:5,showDrawDialog:!1,showTakebackDialog:!1,showRematchDialog:!1}),m=Object(i.a)(u,2),d=m[0],f=m[1];Object(a.useEffect)((function(){return t.once("gameCreated",(function(e){var t=e.gameId,n=e.creatorStarts;f((function(e){0!==e.lifeCycleStage&&(e.gameId=t,e.creatorStarts=n,e.lifeCycleStage=0)}))})),t.once("gameJoined",(function(e){var t=e.creatorName,n=e.timeControl,a=e.creatorStarts;f((function(e){console.log("game joined"),1!==e.lifeCycleStage&&(e.creatorStarts=a,e.names[0]=t,e.timeControl=n,e.moveHistory[0].timeLeft=[60*n.duration,60*n.duration],e.lifeCycleStage=1)}))})),t.once("gameJoinFailed",(function(){T("There is no game with this code waiting for someone to join.",5e3),l()})),t.on("gameNotFoundError",(function(){T("There was an issue on the server and we couldn't reach the other player.",5e3)})),t.once("joinerJoined",(function(e){f((function(t){1!==t.lifeCycleStage&&(t.isVolumeOn&&ee.play(),t.names[1]=e,t.lifeCycleStage=1)}))})),t.on("drawOffered",(function(){f((function(e){e.showDrawDialog=!0}))})),t.on("drawRejected",(function(){T("The opponent declined the draw offer.",5e3)})),t.on("drawAccepted",(function(){T("The opponent accepted the draw offer.",5e3),f((function(e){ge(e,"agreement")}))})),t.on("takebackRequested",(function(){f((function(e){e.showTakebackDialog=!0}))})),t.on("takebackRejected",(function(){T("The opponent declined the takeback request.",5e3)})),t.on("takebackAccepted",(function(){T("The opponent agreed to the takeback. The last move played on the board has been undone.",5e3),f((function(e){ye(e)}))})),t.on("rematchOffered",(function(){f((function(e){e.showRematchDialog=!0}))})),t.on("rematchRejected",(function(){T("The opponent declined the rematch offer.",5e3)})),t.on("rematchAccepted",(function(){T("The opponent accepted the rematch offer.",5e3),f((function(e){e.isVolumeOn&&ee.play(),ve(e)}))})),t.on("extraTimeReceived",(function(){T("The opponent added 60s to your clock.",5e3),f((function(e){we(e,s?0:1)}))})),t.on("opponentResigned",(function(){T("The opponent resigned.",5e3),f((function(e){e.isVolumeOn&&ee.play(),pe(e,!s)}))})),t.on("opponentMoved",(function(e,t,n){f((function(a){console.log("move ".concat(t," received (").concat(n,"s)")),fe(a,e,t,n)}))})),t.on("opponentLeft",(function(){T("The opponent left the game.",5e3),f((function(e){!function(e,t){e.opponentLeft=!0,4!==e.lifeCycleStage&&(e.lifeCycleStage=4,e.winner=t?"joiner":"creator",e.gameWins[t?1:0]+=1,e.finishReason="disconnect",e.ghostAction=null,he(e))}(e,!s)}))})),function(){t.removeAllListeners()}}),[t,f,s,l]),Object(a.useEffect)((function(){-2===d.lifeCycleStage&&(s&&(f((function(e){e.lifeCycleStage=-1})),t.emit("createGame",d.names[0],d.timeControl)),s||(f((function(e){e.lifeCycleStage=-1})),t.emit("joinGame",d.gameId,d.names[1])))}));var h=function(){t.emit("leaveGame"),d.isDarkModeOn&&(document.body.style.backgroundColor=ie),l()};Object(a.useEffect)((function(){var e=setInterval((function(){f((function(e){!function(e){if(3===e.lifeCycleStage){var t=ue(e),n=ce(e);e.moveHistory[n].timeLeft[t]-=1,0===e.moveHistory[n].timeLeft[t]&&(e.winner=0===t?"joiner":"creator",e.gameWins[0===t?1:0]+=1,e.finishReason="time",e.lifeCycleStage=4,e.ghostAction=null,he(e))}}(e)}))}),1e3);return function(){return clearInterval(e)}}),[f]);var g=function(e){if(s===se(d)&&!(d.lifeCycleStage<1)&&!(d.lifeCycleStage>3)&&d.viewIndex===ce(d)&&!(e.r<0||e.r>=te.h||e.c<0||e.c>=te.w)){var n=S(e);if(!(d.lifeCycleStage<3&&"Wall"===n)){var a=function(e){var t=ue(d),n=S(e),a=ce(d);if("Ground"===n)return D(d.moveHistory[a].grid,d.moveHistory[a].playerPos[t],e);if("Wall"===n){var o=w()(d.moveHistory[a].grid),r=w()(d.moveHistory[a].playerPos),l=de(d.ghostAction);return"Wall"===l?o[d.ghostAction.r][d.ghostAction.c]=1:"Ground"===l&&(r[t]=d.ghostAction),L(o,r,oe,e)?1:0}console.error("unexpected action type",n)}(e),o=de(d.ghostAction),r=null,l=null;if("None"===o)if("Wall"===n){if(1!==a)return;l=e}else if("Ground"===n)if(1===a)l=e;else{if(2!==a)return;r=[e]}else console.error("unexpected action type",n);else if("Wall"===o)if("Wall"===n)if(O(d.ghostAction,e))l=null;else{if(1!==a)return;r=[e,d.ghostAction]}else if("Ground"===n){if(1!==a)return;r=[e,d.ghostAction]}else console.error("unexpected action type",n);else if("Ground"===o)if("Wall"===n){if(1!==a)return;r=[e,d.ghostAction]}else if("Ground"===n)if(0===a)l=null;else if(1===a){if(O(e,d.ghostAction))return;l=e}else{if(2!==a)return;r=[e]}else console.error("unexpected action type",n);else console.error("unexpected ghost type",o);if(r){var i=ue(d),c=ce(d),u=d.moveHistory[c].timeLeft[i];3===d.lifeCycleStage&&(u+=d.timeControl.increment),t.emit("move",r,u),f((function(e){fe(e,r,ce(d)+1,u)}))}else f((function(e){e.ghostAction=l}))}}};Object(a.useEffect)((function(){s&&("time"===d.finishReason&&t.emit("playerWonOnTime",d.winner),"goal"===d.finishReason&&t.emit("playerReachedGoal",d.winner))}),[s,t,d.winner,d.finishReason]);Object(a.useEffect)((function(){return window.addEventListener("keydown",p),window.addEventListener("keyup",v),function(){window.removeEventListener("keydown",p),window.removeEventListener("keyup",v)}}));var p=function(e){var t=e.key;if(!d.isKeyPressed)if(f((function(e){e.isKeyPressed=!0})),"m"!==t)if(d.viewIndex<ce(d)||4===d.lifeCycleStage)"ArrowDown"===t||"ArrowRight"===t?f((function(e){e.viewIndex+=1})):"ArrowUp"!==t&&"ArrowLeft"!==t||d.viewIndex>0&&f((function(e){e.viewIndex-=1}));else{var n;if(d.ghostAction&&"Ground"===de(d.ghostAction))n=d.ghostAction;else{var a=ce(d);n=d.moveHistory[a].playerPos[ue(d)]}if("ArrowDown"===t)n={r:n.r+2,c:n.c};else if("ArrowUp"===t)n={r:n.r-2,c:n.c};else if("ArrowLeft"===t)n={r:n.r,c:n.c-2};else{if("ArrowRight"!==t)return;n={r:n.r,c:n.c+2}}g(n)}else f((function(e){e.isVolumeOn=!e.isVolumeOn}))},v=function(){f((function(e){e.isKeyPressed=!1}))},E=function(e){e<0||e>ce(d)||f((function(t){t.viewIndex!==e&&(e>ce(t)||(t.viewIndex=e,t.ghostAction=null))}))};Object(a.useEffect)((function(){var e=document.getElementById("movehistory");e.scrollTop=e.scrollHeight}),[d.moveHistory]);var k=function(e){e.preventDefault(),f((function(e){e.showBackButtonWarning=!0}))};Object(a.useEffect)((function(){return window.history.pushState(null,null,window.location.pathname),window.addEventListener("popstate",k),function(){return window.removeEventListener("popstate",k)}}));var C,x,j,N,I,R=c?[37,12]:[23,10],A=Object(i.a)(R,2),B=A[0],M=A[1],W=Math.pow(1.1,d.zoomLevel-5),G=B*W,H=M*W,z=H*(te.h-1)/2+G*(te.h+1)/2,P=H*(te.w-1)/2+G*(te.w+1)/2,_=c?15:6;if(c){C="".concat(100,"px ").concat(z,"px"),x="".concat(P,"px ").concat(360,"px"),j="'timer status' 'board panel'"}else{C="".concat(50,"px ").concat(z,"px ").concat(80,"px ").concat(z,"px"),x="".concat(P,"px"),j="'timer' 'board' 'status' 'panel'"}if(4===d.lifeCycleStage){var V=Object(i.a)(d.moveHistory[d.viewIndex].timeLeft,2);N=V[0],I=V[1]}else{var q=ce(d),F=Object(i.a)(d.moveHistory[q].timeLeft,2);N=F[0],I=F[1]}return o.a.createElement("div",{className:d.isDarkModeOn?"teal darken-4":void 0},o.a.createElement(Y,{gameName:d.gameId,showLobby:!0,endGame:h,helpText:X(),isLargeScreen:c,isDarkModeOn:d.isDarkModeOn}),o.a.createElement("div",{style:{display:"grid",gridTemplateRows:C,gridTemplateColumns:x,gridTemplateAreas:j,columnGap:"".concat(_,"px"),rowGap:"".concat(_,"px"),margin:"".concat(_,"px"),justifyContent:"center",alignContent:"center"}},o.a.createElement(U,{lifeCycleStage:d.lifeCycleStage,names:d.names,indexToMove:ue(d),playerColors:re,timeLeft:[N,I],isLargeScreen:c,scores:d.gameWins}),o.a.createElement(Q,{lifeCycleStage:d.lifeCycleStage,names:d.names,indexToMove:ue(d),winner:d.winner,finishReason:d.finishReason,timeControl:d.timeControl,creatorStarts:d.creatorStarts,isLargeScreen:c}),o.a.createElement(J,{creatorToMove:se(d),playerColors:re,grid:d.moveHistory[d.viewIndex].grid,playerPos:d.moveHistory[d.viewIndex].playerPos,goals:oe,ghostAction:d.ghostAction,handleClick:function(e){return g(e)},groundSize:G,wallWidth:H,isDarkModeOn:d.isDarkModeOn}),o.a.createElement($,{lifeCycleStage:d.lifeCycleStage,handleResign:function(){t.emit("resign"),f((function(e){pe(e,s)}))},handleOfferDraw:function(){t.emit("offerDraw")},handleRequestTakeback:function(){t.emit("requestTakeback")},handleGiveExtraTime:function(){t.emit("giveExtraTime"),f((function(e){we(e,s?1:0)}))},moveHistory:d.moveHistory,playerColors:re,creatorStarts:d.creatorStarts,handleViewMove:E,viewIndex:d.viewIndex,handleSeeFirstMove:function(){E(0),document.getElementById("movehistory").scrollTop=0},handleSeePreviousMove:function(){return E(d.viewIndex-1)},handleSeeNextMove:function(){return E(d.viewIndex+1)},handleSeeLastMove:function(){E(ce(d));var e=document.getElementById("movehistory");e.scrollTop=e.scrollHeight},handleToggleVolume:function(){f((function(e){e.isVolumeOn=!e.isVolumeOn}))},isVolumeOn:d.isVolumeOn,handleToggleDarkMode:function(){f((function(e){e.isDarkModeOn=!e.isDarkModeOn,e.isDarkModeOn?document.body.style.backgroundColor=le:document.body.style.backgroundColor=ie}))},isDarkModeOn:d.isDarkModeOn,handleIncreaseBoardSize:function(){f((function(e){e.zoomLevel<10&&(e.zoomLevel+=1)}))},handleDecreaseBoardSize:function(){f((function(e){e.zoomLevel>0&&(e.zoomLevel-=1)}))},zoomLevel:d.zoomLevel,boardHeight:z})),4===d.lifeCycleStage&&o.a.createElement(y.Row,{className:"valign-wrapper",style:{marginTop:"1rem"}},o.a.createElement(y.Col,{className:"center",s:12},o.a.createElement(y.Button,{large:!0,className:"red",node:"button",waves:"light",onClick:function(){T("A rematch offer was sent to the opponent. A new game will start if they accept.",5e3),t.emit("offerRematch")},disabled:d.opponentLeft},"Rematch"))),o.a.createElement(K,{isOpen:d.showBackButtonWarning,title:"Return to lobby",body:"Are you sure you want to return to the lobby? You will not be able to rejoin this game.",acceptButtonText:"Quit game",rejectButtonText:"Stay in game",callback:function(e){e?(f((function(e){e.showBackButtonWarning=!1})),h()):f((function(e){e.showBackButtonWarning=!1}))}}),o.a.createElement(K,{isOpen:d.showDrawDialog,title:"Draw offer received",body:"The opponent offered a draw.",acceptButtonText:"Accept",rejectButtonText:"Decline",callback:function(e){e?(t.emit("acceptDraw"),f((function(e){ge(e,"agreement")}))):(t.emit("rejectDraw"),f((function(e){e.showDrawDialog=!1})))}}),o.a.createElement(K,{isOpen:d.showRematchDialog,title:"Rematch offer received",body:"The opponent would like a rematch.",acceptButtonText:"Accept",rejectButtonText:"Decline",callback:function(e){e?(t.emit("acceptRematch"),f((function(e){ve(e)}))):(t.emit("rejectRematch"),f((function(e){e.showRematchDialog=!1})))}}),o.a.createElement(K,{isOpen:d.showTakebackDialog,title:"Takeback request received",body:"The opponent requested a takeback. If you accept, the last move will be undone.",acceptButtonText:"Accept",rejectButtonText:"Decline",callback:function(e){e?(T("The last move played on the board has been undone.",5e3),t.emit("acceptTakeback"),f((function(e){ye(e)}))):(t.emit("rejectTakeback"),f((function(e){e.showTakebackDialog=!1})))}}))},Ee=function(e){var t=e.playerName,n=e.handlePlayerName,r=e.duration,l=e.handleDuration,i=e.increment,c=e.handleIncrement,s=e.joinGameId,u=e.handleJoinGameId,m=e.handleCreateGame,d=e.handleJoinGame,f=e.handleRefreshName;Object(a.useEffect)((function(){return window.addEventListener("keydown",h),function(){window.removeEventListener("keydown",h)}}));var h=function(e){"Enter"===e.key&&(s.length>0?d():(T("Created new game",5e3),m()))};return o.a.createElement("div",{className:"container teal darken-2",style:{marginTop:"2rem"}},o.a.createElement(y.Row,{className:"valign-wrapper"},o.a.createElement(y.Col,{className:"center",s:5,m:4},o.a.createElement("h5",null,"Your name:")),o.a.createElement(y.Col,{s:5,m:3},o.a.createElement(y.TextInput,{id:"nameInput",value:t,onChange:n})),o.a.createElement(y.Col,{s:1,m:1},o.a.createElement(y.Button,{className:"teal lighten-2",node:"button",waves:"light",small:!0,floating:!0,style:{color:"white"},icon:o.a.createElement(y.Icon,null,"refresh"),onClick:f,tooltip:"Get a new name"})),o.a.createElement(y.Col,{s:1,m:4})),o.a.createElement(y.Row,{className:"valign-wrapper"},o.a.createElement(y.Col,{className:"center",s:5,m:4},o.a.createElement(y.Button,{node:"button",waves:"light",onClick:m},"Create game")),o.a.createElement(y.Col,{s:2,m:1,style:{paddingRight:"0"}},o.a.createElement(y.TextInput,{id:"durationInput",label:"Duration",value:"".concat(r),onChange:l})),o.a.createElement(y.Col,{s:1,m:1,style:{paddingLeft:"0"}},"m"),o.a.createElement(y.Col,{s:2,m:1,style:{paddingRight:"0"}},o.a.createElement(y.TextInput,{id:"incrementInput",label:"Increment",value:"".concat(i),onChange:c})),o.a.createElement(y.Col,{s:1,m:1,style:{paddingLeft:"0"}},"s"),o.a.createElement(y.Col,{s:1,m:4})),o.a.createElement(y.Row,{className:"valign-wrapper"},o.a.createElement(y.Col,{className:"center",s:5,m:4},o.a.createElement(y.Button,{node:"button",waves:"light",onClick:d},"Join game")),o.a.createElement(y.Col,{s:6,m:5},o.a.createElement(y.TextInput,{id:"joinInput",placeholder:"Write game code here...",value:"".concat(s),onChange:u})),o.a.createElement(y.Col,{s:1,m:3})))},ke=function(){return o.a.createElement("div",null,o.a.createElement("h6",null,"This is the lobby. Here, you can create games that your friends can join, or join a friend's game. Click on the code to copy it to the clipboard."),o.a.createElement("h6",null,"When you create a game, you can choose the ",o.a.createElement("em",null,"duration")," (the time that each player has) and a time",o.a.createElement("em",null,"increment")," that is added to each player after they move."),o.a.createElement("h6",null,"Once you create a game, a ",o.a.createElement("em",null,"game code")," will appear in the top header. Share this code with your friend to play with them."),o.a.createElement("h6",null,'To join a friend\'s game, write the code they give you in the box next to the "Join game" button and click it.'),o.a.createElement("h6",null,"A random ",o.a.createElement("em",null,"username")," has been chosen for you, but you can change it."))},Ce=function(){return Object(f.b)({dictionaries:[f.a],length:1}).slice(0,9)},xe=function(e){var t=e.socket,n=Object(p.a)(["playerName","duration","increment"]),r=Object(i.a)(n,2),l=r[0],c=r[1],s=Object(a.useState)(l.playerName||Ce()),u=Object(i.a)(s,2),m=u[0],d=u[1],f=Object(a.useState)(l.duration||5),y=Object(i.a)(f,2),v=y[0],w=y[1],b=Object(a.useState)(l.increment||5),E=Object(i.a)(b,2),k=E[0],C=E[1],x=Object(a.useState)(""),S=Object(i.a)(x,2),O=S[0],j=S[1],N=Object(a.useState)(!1),I=Object(i.a)(N,2),D=I[0],R=I[1],A=Object(a.useState)(null),L=Object(i.a)(A,2),B=L[0],M=L[1],W=Object(a.useState)(null),G=Object(i.a)(W,2),H=G[0],z=G[1],P=Object(h.useMediaQuery)({query:"(min-width: 990px)"});return o.a.createElement("div",{style:{marginBottom:"2rem"}},o.a.createElement(g.b,null),D&&o.a.createElement(be,{socket:t,creatorParams:B,joinerParams:H,returnToLobby:function(){R(!1),M(null),z(null),j("")},isLargeScreen:P}),!D&&o.a.createElement("div",null,o.a.createElement(Y,{gameName:"",helpText:ke(),isLargeScreen:P}),o.a.createElement(Ee,{playerName:m,handlePlayerName:function(e){d(e.target.value.slice(0,9))},duration:v,handleDuration:function(e){return w(e.target.value)},increment:k,handleIncrement:function(e){return C(e.target.value)},joinGameId:O,handleJoinGameId:function(e){return j(e.target.value)},handleCreateGame:function(){var e=[parseFloat(v),parseFloat(k)],t=e[0],n=e[1];isNaN(t)||t<.1?(t=5/60,T("Invalid duration, using 5s instead",5e3)):t>120?(t=120,T("Duration too long, using 2h instead",5e3)):c("duration",t,{path:"/"}),isNaN(n)||n<0?(n=0,T("Invalid increment, using 0s instead",5e3)):n>300?(n=300,T("Increment too large, using 5m instead",5e3)):c("increment",n,{path:"/"});var a=m;""===a?a="Anon":c("playerName",a,{path:"/"}),M({timeControl:{duration:t,increment:n},creatorName:a}),R(!0)},handleJoinGame:function(){var e=m;""===e?e="Anon":c("playerName",e,{path:"/"}),z({gameId:O,joinerName:e}),R(!0)},handleRefreshName:function(){d(Ce())}})))},Te=function(){console.log("connecting to backend at ".concat("https://wallwars.herokuapp.com/"));var e=Object(a.useState)(m()("https://wallwars.herokuapp.com/")),t=Object(i.a)(e,1)[0];return o.a.createElement(o.a.StrictMode,null,o.a.createElement(d.a,null,o.a.createElement(c.a,null,o.a.createElement(s.d,null,o.a.createElement(s.b,{path:"/wallwars/index.html",exact:!0},o.a.createElement(xe,{socket:t})),o.a.createElement(s.a,{to:"/wallwars/index.html"})))))};l.a.render(o.a.createElement(Te,null),document.getElementById("root"))},68:function(e,t,n){e.exports=n.p+"static/media/moveSound.6df49e4b.mp3"},75:function(e,t,n){e.exports=n(165)},80:function(e,t,n){}},[[75,1,2]]]);
//# sourceMappingURL=main.43854c6c.chunk.js.map